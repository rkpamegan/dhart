<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.5"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>DHART: Using the RayTracer</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome-css.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">DHART
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.5 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('_using_the_raytracer.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Using the RayTracer </div></div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#autotoc_md7">Intro</a></li>
<li class="level1"><a href="#autotoc_md8">Writing the Script</a><ul><li class="level2"><a href="#autotoc_md9">Using Declarations</a></li>
<li class="level2"><a href="#autotoc_md10">Creating a Plane</a></li>
<li class="level2"><a href="#autotoc_md11">Casting a Ray</a></li>
<li class="level2"><a href="#autotoc_md12">Wrapping Up</a></li>
</ul>
</li>
<li class="level1"><a href="#autotoc_md13">Testing</a><ul><li class="level2"><a href="#autotoc_md14">Adding the script to the camera</a></li>
<li class="level2"><a href="#autotoc_md15">Executing the Script</a></li>
</ul>
</li>
<li class="level1"><a href="#autotoc_md16">Conclusion</a></li>
</ul>
</div>
<div class="textblock"><p ><a class="anchor" id="md_src_Csharp_docs_markdown_2_raycast_at_plane"></a> Previous Tutorial: <a class="el" href="_unity_project_setup.html">Project Setup</a> | Next Tutorial: <a class="el" href="_generating_a_graph.html">Graph Generator</a></p>
<h1><a class="anchor" id="autotoc_md7"></a>
Intro</h1>
<p >Now that we know the <a class="el" href="namespace_d_h_a_r_t_a_p_i.html" title="Automated analysis of the built environent">DHARTAPI</a> library can be referenced by our new Unity Project, let's check to see that it's working by writing a simple script that utilizes the Raytracer. Ray intersections are used internally by many of the analysis methods in <a class="el" href="namespace_d_h_a_r_t_a_p_i.html" title="Automated analysis of the built environent">DHARTAPI</a>, and can be an extremely useful tool for analyzing space. In this tutorial we will write a script that performs the following when playmode is entered:</p>
<ol type="1">
<li>Create a Plane in <a class="el" href="namespace_d_h_a_r_t_a_p_i.html" title="Automated analysis of the built environent">DHARTAPI</a> from vertices and triangle indices.</li>
<li>Cast a ray at the plane.</li>
<li>Print the point where the ray intersected the plane.</li>
</ol>
<p >This tutorial assumes that you've completed the first tutorial, since we will be using the project created in it as a base, and building upon concepts first established there. If you want to start here, you can download the full Unity project at the end of the previous tutorial.</p>
<p >Now, let's begin writing our script.</p>
<h1><a class="anchor" id="autotoc_md8"></a>
Writing the Script</h1>
<div class="image">
<img src="blank_new_behaviour_script.png" alt=""/>
<div class="caption">
HFExampleScriptBlank</div></div>
    <p ><em>Figure</em> <b>2.1</b>: <em>A Blank MonoBehavior Script</em></p>
<p >In the Visual Studio window we opened in the last tutorial, look at the contents of HFExampleScript.cs. The contents should match that of Figure 2.1. Once you're sure of this, it's time to start filling it in.</p>
<blockquote class="doxtable">
<p >&zwj;<b>NOTE</b>: Remember, if you ever exit out of Visual Studio, you can always reopen it by double clicking a script in the assets window of the unity editor. </p>
</blockquote>
<h2><a class="anchor" id="autotoc_md9"></a>
Using Declarations</h2>
<p >Before getting into the logic of the script itself, we will add using declarations for the namespaces in <a class="el" href="namespace_d_h_a_r_t_a_p_i.html" title="Automated analysis of the built environent">DHARTAPI</a> that we plan to reference.</p>
<p >Add the following lines to the top of the script starting at line 4.</p>
<div class="fragment"><div class="line"><span class="keyword">using </span><a class="code hl_namespace" href="namespace_d_h_a_r_t_a_p_i.html">DHARTAPI</a>;</div>
<div class="line"><span class="keyword">using </span><a class="code hl_namespace" href="namespace_d_h_a_r_t_a_p_i_1_1_ray_tracing.html">DHARTAPI.RayTracing</a>;</div>
<div class="line"><span class="keyword">using </span><a class="code hl_namespace" href="namespace_d_h_a_r_t_a_p_i_1_1_geometry.html">DHARTAPI.Geometry</a>;</div>
<div class="ttc" id="anamespace_d_h_a_r_t_a_p_i_1_1_geometry_html"><div class="ttname"><a href="namespace_d_h_a_r_t_a_p_i_1_1_geometry.html">DHARTAPI.Geometry</a></div><div class="ttdoc">Manipulate and load geometry from disk.</div><div class="ttdef"><b>Definition:</b> CommonRotations.cs:4</div></div>
<div class="ttc" id="anamespace_d_h_a_r_t_a_p_i_1_1_ray_tracing_html"><div class="ttname"><a href="namespace_d_h_a_r_t_a_p_i_1_1_ray_tracing.html">DHARTAPI.RayTracing</a></div><div class="ttdoc">Cast rays to determine if and where they intersect geometry.</div><div class="ttdef"><b>Definition:</b> EmbreeBVH.cs:7</div></div>
<div class="ttc" id="anamespace_d_h_a_r_t_a_p_i_html"><div class="ttname"><a href="namespace_d_h_a_r_t_a_p_i.html">DHARTAPI</a></div><div class="ttdoc">Automated analysis of the built environent</div><div class="ttdef"><b>Definition:</b> CommonTypes.cs:9</div></div>
</div><!-- fragment --><div class="image">
<img src="add_using_delcarations.png" alt=""/>
<div class="caption">
HFExampleScript Usings</div></div>
    <p ><em>Figure</em> <b>2.2</b>: <em>The Using declarations required for this script</em></p>
<p >Lines, 1-6 of your code should match Figure 2.2.</p>
<blockquote class="doxtable">
<p >&zwj;<b>NOTE:</b> While editing your code, you may notice the colored bar to the left between the line numbers and the code itself. This bar displays the changes you've made to the current document. When you make unsaved changes, the bar will appear and be colored yellow, then once you save it will turn green. </p>
</blockquote>
<p><img src="body_of_start.png" alt="" class="inline" title="Body Of Start"/>    </p>
<p ><em>Figure</em> <b>2.3</b>: <em>The body of the Start method highlighted</em></p>
<p >With using declarations in place, we'll be writing the rest of our code in the body of the <code>Start()</code> method beginning on line 13 (highlighted in yellow in Figure 2.3).</p>
<h2><a class="anchor" id="autotoc_md10"></a>
Creating a Plane</h2>
<p >Now we will create a plane for our ray to intersect. Every mesh is, at minimum, comprised of two arrays:</p>
<ol type="1">
<li>An array of floats containing the (x,y,z) location of every vertex in the mesh.</li>
<li>An array of integers containing the indices for each triangle or "face" of the mesh.</li>
</ol>
<p >A plane is comprised of four vertices, and two triangles. Here are the vertex and index arrays for a 10x10 plane on the xy plane.</p>
<div class="fragment"><div class="line"><span class="comment">// Create arrays for the plane&#39;s vertices and indices</span></div>
<div class="line"><span class="keywordtype">float</span>[] plane_vertices = {</div>
<div class="line">    -10f, 10f, 0f,</div>
<div class="line">    -10f, -10f, 0f,</div>
<div class="line">     10f, 10f, 0f,</div>
<div class="line">     10f, -10f, 0f</div>
<div class="line">};</div>
<div class="line"><span class="keywordtype">int</span>[] plane_indices = {</div>
<div class="line">  3, 1, 0,</div>
<div class="line">  2, 3, 0</div>
<div class="line">};</div>
</div><!-- fragment --><p >In the index and vertex array, every 3 elements represent a separate triangle or vertex respectively. So, the first vertex is at location (-10,10,0) and the first triangle is comprised of the fourth, second, and first vertices. For more information on what both arrays mean, see out the [MeshInfo Documentation]().</p>
<p ><b>TODO</b>: Replace the empty links with links to our documentation.</p>
<p >We will use these arrays to construct a new <em>MeshInfo</em> object in <a class="el" href="namespace_d_h_a_r_t_a_p_i.html" title="Automated analysis of the built environent">DHARTAPI</a>. Call the MeshInfo constructor with the two arrays we defined above as arguments.</p>
<div class="fragment"><div class="line"><span class="comment">// Construct a meshinfo instance for the plane</span></div>
<div class="line"><a class="code hl_class" href="class_d_h_a_r_t_a_p_i_1_1_geometry_1_1_mesh_info.html">MeshInfo</a> Plane = <span class="keyword">new</span> <a class="code hl_class" href="class_d_h_a_r_t_a_p_i_1_1_geometry_1_1_mesh_info.html">MeshInfo</a>(plane_indices, plane_vertices);</div>
<div class="ttc" id="aclass_d_h_a_r_t_a_p_i_1_1_geometry_1_1_mesh_info_html"><div class="ttname"><a href="class_d_h_a_r_t_a_p_i_1_1_geometry_1_1_mesh_info.html">DHARTAPI.Geometry.MeshInfo</a></div><div class="ttdoc">A collection of vertices and indices representing geometry.</div><div class="ttdef"><b>Definition:</b> MeshInfo.cs:50</div></div>
</div><!-- fragment --><p >Before we can use this geometry with the Raytracer, we must first generate a Bounding Volume Hierarchy, or BVH using the geometry as input. In short, a BVH is an accelerated data structure that drastically reduces the time required to perform ray intersections. You can read more about the BVH in its dedicated article [Bounding Volume Hierarchy]().</p>
<p >To generate a BVH from an instance of MeshInfo, call the BVH constructor with the MeshInfo instance as an argument.</p>
<div class="fragment"><div class="line"><span class="comment">// Generate a BVH from the MeshInfo instance</span></div>
<div class="line"><a class="code hl_class" href="class_d_h_a_r_t_a_p_i_1_1_ray_tracing_1_1_embree_b_v_h.html">EmbreeBVH</a> bvh = <span class="keyword">new</span> <a class="code hl_class" href="class_d_h_a_r_t_a_p_i_1_1_ray_tracing_1_1_embree_b_v_h.html">EmbreeBVH</a>(Plane);</div>
<div class="ttc" id="aclass_d_h_a_r_t_a_p_i_1_1_ray_tracing_1_1_embree_b_v_h_html"><div class="ttname"><a href="class_d_h_a_r_t_a_p_i_1_1_ray_tracing_1_1_embree_b_v_h.html">DHARTAPI.RayTracing.EmbreeBVH</a></div><div class="ttdoc">A Bounding Volume Hierarchy for the EmbreeRaytracer.</div><div class="ttdef"><b>Definition:</b> EmbreeBVH.cs:31</div></div>
</div><!-- fragment --><p >At this point, your start function should match the following code:</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> Start()</div>
<div class="line">{</div>
<div class="line">    <span class="comment">// Create arrays for the plane&#39;s vertices and indices</span></div>
<div class="line">    <span class="keywordtype">float</span>[] plane_vertices = {</div>
<div class="line">        -10f, 10f, 0f,</div>
<div class="line">        -10f, -10f, 0f,</div>
<div class="line">         10f, 10f, 0f,</div>
<div class="line">         10f, -10f, 0f</div>
<div class="line">    };</div>
<div class="line">    <span class="keywordtype">int</span>[] plane_indices = {</div>
<div class="line">      3, 1, 0,</div>
<div class="line">      2, 3, 0</div>
<div class="line">    };</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Construct a meshinfo instance for the plane</span></div>
<div class="line">    <a class="code hl_class" href="class_d_h_a_r_t_a_p_i_1_1_geometry_1_1_mesh_info.html">MeshInfo</a> Plane = <span class="keyword">new</span> <a class="code hl_class" href="class_d_h_a_r_t_a_p_i_1_1_geometry_1_1_mesh_info.html">MeshInfo</a>(plane_indices, plane_vertices);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Generate a BVH from the MeshInfo instance</span></div>
<div class="line">    <a class="code hl_class" href="class_d_h_a_r_t_a_p_i_1_1_ray_tracing_1_1_embree_b_v_h.html">EmbreeBVH</a> bvh = <span class="keyword">new</span> <a class="code hl_class" href="class_d_h_a_r_t_a_p_i_1_1_ray_tracing_1_1_embree_b_v_h.html">EmbreeBVH</a>(Plane);</div>
<div class="line">}</div>
</div><!-- fragment --><div class="image">
<img src="creating_a_plane.png" alt=""/>
<div class="caption">
Image in Visual Studio</div></div>
    <p >With the BVH created, we're ready to call the Raytracer and cast a ray.</p>
<h2><a class="anchor" id="autotoc_md11"></a>
Casting a Ray</h2>
<p >We'll put the origin point of the ray at (1,0,1) and cast it in the direction (0,0,-1). This should intersect with the plane we defined earlier at the point (1,0,0). In the start method, just below the line we create the BVH, define an origin point and a direction for the ray.</p>
<div class="fragment"><div class="line"><span class="comment">// Define origin and direction</span></div>
<div class="line"><a class="code hl_struct" href="struct_d_h_a_r_t_a_p_i_1_1_vector3_d.html">Vector3D</a> origin = <span class="keyword">new</span> <a class="code hl_struct" href="struct_d_h_a_r_t_a_p_i_1_1_vector3_d.html">Vector3D</a>(1, 0, 1);</div>
<div class="line"><a class="code hl_struct" href="struct_d_h_a_r_t_a_p_i_1_1_vector3_d.html">Vector3D</a> direction = <span class="keyword">new</span> <a class="code hl_struct" href="struct_d_h_a_r_t_a_p_i_1_1_vector3_d.html">Vector3D</a>(0, 0, -1);</div>
<div class="ttc" id="astruct_d_h_a_r_t_a_p_i_1_1_vector3_d_html"><div class="ttname"><a href="struct_d_h_a_r_t_a_p_i_1_1_vector3_d.html">DHARTAPI.Vector3D</a></div><div class="ttdoc">A three dimensional vector with built in utility functions.</div><div class="ttdef"><b>Definition:</b> CommonTypes.cs:40</div></div>
</div><!-- fragment --><p >Depending on which function you call, the EmbreeRaytracer can return 3 different types of information:</p>
<ol type="1">
<li>The coordinates where a ray intersected the mesh.</li>
<li>The distance from the ray's origin to the point where it intersected the mesh</li>
<li>A boolean true/false for whether the ray intersected the mesh at any point.</li>
</ol>
<p >For this guide we will use [IntersectForPoint]() to get the point where the ray intersects the mesh. Starting on line 35 call the EmbreeRayTracer's <b>IntersectForPoint</b> function with the bvh, origin and direction as arguments.</p>
<div class="fragment"><div class="line"><span class="comment">// Cast the ray, store the hitpoint.</span></div>
<div class="line"><a class="code hl_struct" href="struct_d_h_a_r_t_a_p_i_1_1_vector3_d.html">Vector3D</a> intersection_point = <a class="code hl_class" href="class_d_h_a_r_t_a_p_i_1_1_ray_tracing_1_1_embree_raytracer.html">EmbreeRaytracer</a>.<a class="code hl_function" href="class_d_h_a_r_t_a_p_i_1_1_ray_tracing_1_1_embree_raytracer.html#a51936c4b5e5718f4fa2a7696bf7a9108">IntersectForPoint</a>(bvh, origin, direction);</div>
<div class="ttc" id="aclass_d_h_a_r_t_a_p_i_1_1_ray_tracing_1_1_embree_raytracer_html"><div class="ttname"><a href="class_d_h_a_r_t_a_p_i_1_1_ray_tracing_1_1_embree_raytracer.html">DHARTAPI.RayTracing.EmbreeRaytracer</a></div><div class="ttdoc">Cast rays with Intel's Embree raytracing library.</div><div class="ttdef"><b>Definition:</b> EmbreeRayTracer.cs:41</div></div>
<div class="ttc" id="aclass_d_h_a_r_t_a_p_i_1_1_ray_tracing_1_1_embree_raytracer_html_a51936c4b5e5718f4fa2a7696bf7a9108"><div class="ttname"><a href="class_d_h_a_r_t_a_p_i_1_1_ray_tracing_1_1_embree_raytracer.html#a51936c4b5e5718f4fa2a7696bf7a9108">DHARTAPI.RayTracing.EmbreeRaytracer.IntersectForPoint</a></div><div class="ttdeci">static Vector3D IntersectForPoint(EmbreeBVH bvh, float x, float y, float z, float dx, float dy, float dz, float max_distance=-1)</div><div class="ttdoc">Cast a single ray, and get a point in return if it intersects any geometry.</div></div>
</div><!-- fragment --><p >Finally, log the point of intersection to Unity's console using <code>Debug.Log()</code> so we can view the results.</p>
<div class="fragment"><div class="line"><span class="comment">// Print the x, y, and z components of the intersection point</span></div>
<div class="line">Debug.Log(</div>
<div class="line">    <span class="stringliteral">&quot;(&quot;</span> + intersection_point.<a class="code hl_variable" href="struct_d_h_a_r_t_a_p_i_1_1_vector3_d.html#a46b34f99709c14b7d8be79cf1b0debbc">x</a> +</div>
<div class="line">    <span class="stringliteral">&quot;,&quot;</span> + intersection_point.<a class="code hl_variable" href="struct_d_h_a_r_t_a_p_i_1_1_vector3_d.html#a15acdf142c31ca74018da12d8516a85f">y</a> +</div>
<div class="line">    <span class="stringliteral">&quot;,&quot;</span> + intersection_point.<a class="code hl_variable" href="struct_d_h_a_r_t_a_p_i_1_1_vector3_d.html#abac3c90f7958d6d98ba3e7c81cfbd6ab">z</a> +</div>
<div class="line"><span class="stringliteral">&quot;)&quot;</span>);</div>
<div class="ttc" id="astruct_d_h_a_r_t_a_p_i_1_1_vector3_d_html_a15acdf142c31ca74018da12d8516a85f"><div class="ttname"><a href="struct_d_h_a_r_t_a_p_i_1_1_vector3_d.html#a15acdf142c31ca74018da12d8516a85f">DHARTAPI.Vector3D.y</a></div><div class="ttdeci">readonly float y</div><div class="ttdoc">Y component of this vector.</div><div class="ttdef"><b>Definition:</b> CommonTypes.cs:42</div></div>
<div class="ttc" id="astruct_d_h_a_r_t_a_p_i_1_1_vector3_d_html_a46b34f99709c14b7d8be79cf1b0debbc"><div class="ttname"><a href="struct_d_h_a_r_t_a_p_i_1_1_vector3_d.html#a46b34f99709c14b7d8be79cf1b0debbc">DHARTAPI.Vector3D.x</a></div><div class="ttdeci">readonly float x</div><div class="ttdoc">X component of this vector.</div><div class="ttdef"><b>Definition:</b> CommonTypes.cs:41</div></div>
<div class="ttc" id="astruct_d_h_a_r_t_a_p_i_1_1_vector3_d_html_abac3c90f7958d6d98ba3e7c81cfbd6ab"><div class="ttname"><a href="struct_d_h_a_r_t_a_p_i_1_1_vector3_d.html#abac3c90f7958d6d98ba3e7c81cfbd6ab">DHARTAPI.Vector3D.z</a></div><div class="ttdeci">readonly float z</div><div class="ttdoc">Z component of this vector.</div><div class="ttdef"><b>Definition:</b> CommonTypes.cs:43</div></div>
</div><!-- fragment --><p >Here's all of that together:</p>
<div class="fragment"><div class="line"><span class="comment">// Define origin and direction</span></div>
<div class="line"><a class="code hl_struct" href="struct_d_h_a_r_t_a_p_i_1_1_vector3_d.html">Vector3D</a> origin = <span class="keyword">new</span> <a class="code hl_struct" href="struct_d_h_a_r_t_a_p_i_1_1_vector3_d.html">Vector3D</a>(1, 0, 1);</div>
<div class="line"><a class="code hl_struct" href="struct_d_h_a_r_t_a_p_i_1_1_vector3_d.html">Vector3D</a> direction = <span class="keyword">new</span> <a class="code hl_struct" href="struct_d_h_a_r_t_a_p_i_1_1_vector3_d.html">Vector3D</a>(0, 0, -1);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Cast the ray, store the hitpoint</span></div>
<div class="line"><a class="code hl_struct" href="struct_d_h_a_r_t_a_p_i_1_1_vector3_d.html">Vector3D</a> intersection_point = <a class="code hl_class" href="class_d_h_a_r_t_a_p_i_1_1_ray_tracing_1_1_embree_raytracer.html">EmbreeRaytracer</a>.<a class="code hl_function" href="class_d_h_a_r_t_a_p_i_1_1_ray_tracing_1_1_embree_raytracer.html#a51936c4b5e5718f4fa2a7696bf7a9108">IntersectForPoint</a>(bvh, origin, direction);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Print the x, y, and z components of the intersection_point</span></div>
<div class="line">Debug.Log(</div>
<div class="line">    <span class="stringliteral">&quot;(&quot;</span> + intersection_point.<a class="code hl_variable" href="struct_d_h_a_r_t_a_p_i_1_1_vector3_d.html#a46b34f99709c14b7d8be79cf1b0debbc">x</a> +</div>
<div class="line">    <span class="stringliteral">&quot;,&quot;</span> + intersection_point.<a class="code hl_variable" href="struct_d_h_a_r_t_a_p_i_1_1_vector3_d.html#a15acdf142c31ca74018da12d8516a85f">y</a> +</div>
<div class="line">    <span class="stringliteral">&quot;,&quot;</span> + intersection_point.<a class="code hl_variable" href="struct_d_h_a_r_t_a_p_i_1_1_vector3_d.html#abac3c90f7958d6d98ba3e7c81cfbd6ab">z</a> +</div>
<div class="line"><span class="stringliteral">&quot;)&quot;</span>);</div>
</div><!-- fragment --><div class="image">
<img src="casting_a_ray.png" alt=""/>
<div class="caption">
Image of our Start() function up until this point</div></div>
    <h2><a class="anchor" id="autotoc_md12"></a>
Wrapping Up</h2>
<p >Here is the final script we've been building in this tutorial.</p>
<div class="fragment"><div class="line"><span class="keyword">using </span>System.Collections;</div>
<div class="line"><span class="keyword">using </span>System.Collections.Generic;</div>
<div class="line"><span class="keyword">using </span>UnityEngine;</div>
<div class="line"><span class="keyword">using </span><a class="code hl_namespace" href="namespace_d_h_a_r_t_a_p_i.html">DHARTAPI</a>;</div>
<div class="line"><span class="keyword">using </span><a class="code hl_namespace" href="namespace_d_h_a_r_t_a_p_i_1_1_ray_tracing.html">DHARTAPI.RayTracing</a>;</div>
<div class="line"><span class="keyword">using </span><a class="code hl_namespace" href="namespace_d_h_a_r_t_a_p_i_1_1_geometry.html">DHARTAPI.Geometry</a>;</div>
<div class="line"> </div>
<div class="line"><span class="keyword">public</span> <span class="keyword">class </span>HFExampleScript : MonoBehaviour</div>
<div class="line">{</div>
<div class="line">    <span class="comment">// Start is called before the first frame update</span></div>
<div class="line">    <span class="keywordtype">void</span> Start()</div>
<div class="line">    {</div>
<div class="line">        <span class="comment">// Create arrays for the plane&#39;s vertices and indices</span></div>
<div class="line">        <span class="keywordtype">float</span>[] plane_vertices = {</div>
<div class="line">            -10f, 10f, 0f,</div>
<div class="line">            -10f, -10f, 0f,</div>
<div class="line">             10f, 10f, 0f,</div>
<div class="line">             10f, -10f, 0f</div>
<div class="line">        };</div>
<div class="line">        <span class="keywordtype">int</span>[] plane_indices = {</div>
<div class="line">          3, 1, 0,</div>
<div class="line">          2, 3, 0</div>
<div class="line">        };</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// Construct a meshinfo instance for the plane</span></div>
<div class="line">        <a class="code hl_class" href="class_d_h_a_r_t_a_p_i_1_1_geometry_1_1_mesh_info.html">MeshInfo</a> Plane = <span class="keyword">new</span> <a class="code hl_class" href="class_d_h_a_r_t_a_p_i_1_1_geometry_1_1_mesh_info.html">MeshInfo</a>(plane_indices, plane_vertices);</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// Generate a BVH from the MeshInfo instance</span></div>
<div class="line">        <a class="code hl_class" href="class_d_h_a_r_t_a_p_i_1_1_ray_tracing_1_1_embree_b_v_h.html">EmbreeBVH</a> bvh = <span class="keyword">new</span> <a class="code hl_class" href="class_d_h_a_r_t_a_p_i_1_1_ray_tracing_1_1_embree_b_v_h.html">EmbreeBVH</a>(Plane);</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// Define origin and direction</span></div>
<div class="line">        <a class="code hl_struct" href="struct_d_h_a_r_t_a_p_i_1_1_vector3_d.html">Vector3D</a> origin = <span class="keyword">new</span> <a class="code hl_struct" href="struct_d_h_a_r_t_a_p_i_1_1_vector3_d.html">Vector3D</a>(1, 0, 1);</div>
<div class="line">        <a class="code hl_struct" href="struct_d_h_a_r_t_a_p_i_1_1_vector3_d.html">Vector3D</a> direction = <span class="keyword">new</span> <a class="code hl_struct" href="struct_d_h_a_r_t_a_p_i_1_1_vector3_d.html">Vector3D</a>(0, 0, -1);</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// Cast the ray, store the hitpoint</span></div>
<div class="line">        <a class="code hl_struct" href="struct_d_h_a_r_t_a_p_i_1_1_vector3_d.html">Vector3D</a> intersection_point = <a class="code hl_class" href="class_d_h_a_r_t_a_p_i_1_1_ray_tracing_1_1_embree_raytracer.html">EmbreeRaytracer</a>.<a class="code hl_function" href="class_d_h_a_r_t_a_p_i_1_1_ray_tracing_1_1_embree_raytracer.html#a51936c4b5e5718f4fa2a7696bf7a9108">IntersectForPoint</a>(bvh, origin, direction);</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// Print the x, y, and z components of the intersection_point</span></div>
<div class="line">        Debug.Log(</div>
<div class="line">            <span class="stringliteral">&quot;(&quot;</span> + intersection_point.<a class="code hl_variable" href="struct_d_h_a_r_t_a_p_i_1_1_vector3_d.html#a46b34f99709c14b7d8be79cf1b0debbc">x</a> +</div>
<div class="line">            <span class="stringliteral">&quot;,&quot;</span> + intersection_point.<a class="code hl_variable" href="struct_d_h_a_r_t_a_p_i_1_1_vector3_d.html#a15acdf142c31ca74018da12d8516a85f">y</a> +</div>
<div class="line">            <span class="stringliteral">&quot;,&quot;</span> + intersection_point.<a class="code hl_variable" href="struct_d_h_a_r_t_a_p_i_1_1_vector3_d.html#abac3c90f7958d6d98ba3e7c81cfbd6ab">z</a> +</div>
<div class="line">        <span class="stringliteral">&quot;)&quot;</span>);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Update is called once per frame</span></div>
<div class="line">    <span class="keywordtype">void</span> Update()</div>
<div class="line">    {</div>
<div class="line"> </div>
<div class="line">    }</div>
<div class="line">}</div>
</div><!-- fragment --><p >Once you've verified your code matches, <em><b>make sure to save the script by clicking File then Save in the top menu or pressing Ctrl + S on your keyboard.</b></em> Unity will NOT be able to use the script unless you save it. If you're unsure, the bar on the left-hand side between your code and the line numbers should be solid green, and the title of your assembly should not have an asterisk next to it.</p>
<div class="image">
<img src="saved_vs_unsaved.png" alt=""/>
<div class="caption">
Add Using DHARTAPI</div></div>
    <h1><a class="anchor" id="autotoc_md13"></a>
Testing</h1>
<p >Now that we have a usable script, we need to attach it to some game object in order to run it. Let's minimize the Visual Studio window and go back to the Unity Editor.</p>
<h2><a class="anchor" id="autotoc_md14"></a>
Adding the script to the camera</h2>
<div class="image">
<img src="drag_into_camera.png" alt=""/>
<div class="caption">
Drag HFExampleScript.cs Into Camera</div></div>
    <p ><em>Figure</em> <b>2.4</b> <em>Adding HFExampleScript to the camera as a component</em></p>
<p >In the Unity window drag <em>HFExampleScript.cs</em> to <em>Main Camera</em> in the scene hierarchy like shown in Figure 2.4. After doing this, it may appear as if nothing happened, but by dragging HFExampleScript over the camera you've added HFExampleScript to the camera as a component.</p>
<div class="image">
<img src="camera_in_sidebar.png" alt=""/>
<div class="caption">
Look At Camera In Sidebar</div></div>
    <p ><em>Figure</em> <b>2.5</b> <em>Viewing the components of the Main Camera</em></p>
<p >You can verify that the script has been added to the camera by left clicking the camera in the scene hierarchy and looking at its components in the Inspector on the right sidebar. At the bottom of the Inspector you should see a header for HF Example Script like the one highlighted in Figure 2.5. Once you've made sure it exists, you can click on an empty space in the scene view to deselect the camera.</p>
<blockquote class="doxtable">
<p >&zwj;<b>NOTE</b>: If you don't see the inspector in the right sidebar, you can enable it by selecting Window &gt; General &gt; Inspector from the top menubar.<img src="re_open_inspector.png" alt="" class="inline" title="Re-Open Inspector"/>     </p>
</blockquote>
<blockquote class="doxtable">
<p >&zwj;<b>NOTE</b>: If you notice multiple copies of the script in the Inspector, you can remove duplicates by left clicking on the rightmost side of header for the duplicate components' headers, then clicking <em>Remove Component</em>. </p>
</blockquote>
<p>&gt;<img src="remove_extra_component.png" alt="" class="inline" title="Remove Extra Component"/>    </p>
<h2><a class="anchor" id="autotoc_md15"></a>
Executing the Script</h2>
<p >Now that we've set <em>HFExampleScript</em> as a component of the <em>Main Camera</em>, its <code>Start()</code> function containing our code will run when the editor enters play mode.</p>
<div class="image">
<img src="play_mode_button.png" alt=""/>
<div class="caption">
Look At Camera In Sidebar</div></div>
    <p ><em>Figure</em> <b>2.6</b> <em>Circled play button in editor window</em></p>
<p >To enter playmode, press the play button located at the top center of your screen, circled in red in Figure 2.6. Once clicked, you will enter play mode, indicated by the play button turning blue.</p>
<blockquote class="doxtable">
<p >&zwj;<b>NOTE:</b> If when entering play mode, the game window becomes full screen like below, that means you have the <em>Maximize On Play</em> option enabled. You can disable it by pressing the <em>Maximize On Play</em> button circled in red below. For this tutorial series, we will leave this option off since it hides the console. </p>
</blockquote>
<p>&gt;<img src="playmode_maximize_on_play.png" alt="" class="inline" title="Circled Maximize On Play Button"/>    </p>
<div class="image">
<img src="console_show_meshinfo.png" alt=""/>
<div class="caption">
Add Using DHARTAPI</div></div>
    <p ><em>Figure</em> <b>2.7A</b> <em>Intersection Results in play mode.</em></p>
<div class="image">
<img src="ExpectedOutput.png" alt=""/>
<div class="caption">
Console Output</div></div>
    <p ><em>Figure</em> <b>2.7B</b> <em>Results from 2.7A magnified</em></p>
<p >If everything went right, after entering play mode the console located at the bottom of your editor's window should show <code>(1,0,0)</code>, which is the exact point where the ray intersected the plane. Figure 2.7B is a magnified version of the console's output enclosed by the red box shown in 2.7A.</p>
<blockquote class="doxtable">
<p >&zwj;<b>NOTE</b>: If you see no output at all, that means your version of Unity has log messages disabled. To enable log messages click on the Console tab just above the assets window to open the console. <img src="click_console_tab.png" alt="" class="inline" title="Change To Console"/>     After this, you should notice the three buttons in the top right of the console window. The Left most button with an exclamation point in a speech bubble should be greyed out. Click on this button to enable log messages. <img src="click_to_enable_log_messages.png" alt="" class="inline" title="Enable Log Messages"/>     You will see your output in the space where the assets tab occupied, instead of the bottom bar. You can switch back to the assets window by clicking the project tab to the left of the console tab. <img src="enabled_log_messages.png" alt="" class="inline" title="Back to Assets"/>     Future calls to <code>Debug.Log()</code> will appear at the bottom of the screen like shown in Figure 2.4. </p>
</blockquote>
<p>If your console's output matches, then you've successfully completed this tutorial. You can press the play button again to exit playmode.</p>
<h1><a class="anchor" id="autotoc_md16"></a>
Conclusion</h1>
<p >Full project Link: <a href="Tutorial%202%20-%20Unity%20Project.zip">Tutorial 2: Casting a Ray at A Plane</a></p>
<p >In this tutorial we've successfully created a plane from an array of vertices and triangle indexes, then casted a ray at it, then found the point where the ray and the plane intersected. Through this we've gained some experience using Visual Studio with Unity and became more familiar with the Editor's UI. In the next tutorial we will build upon this experience to cover a core part of the <a class="el" href="namespace_d_h_a_r_t_a_p_i.html" title="Automated analysis of the built environent">DHARTAPI</a> Library: The <a class="el" href="_generating_a_graph.html">Graph Generator</a>. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Mon Aug 18 2025 13:05:18 for DHART by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.5 </li>
  </ul>
</div>
</body>
</html>
