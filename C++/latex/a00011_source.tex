\hypertarget{a00011_source}{}\doxysection{graph\+\_\+utils.\+cpp}
\label{a00011_source}\index{Cpp/analysismethods/src/graph\_utils.cpp@{Cpp/analysismethods/src/graph\_utils.cpp}}
\mbox{\hyperlink{a00011}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{\Hypertarget{a00011_source_l00001}00001 \textcolor{preprocessor}{\#include <\mbox{\hyperlink{a00008}{graph\_generator.h}}>}}
\DoxyCodeLine{\Hypertarget{a00011_source_l00002}00002 }
\DoxyCodeLine{\Hypertarget{a00011_source_l00003}00003 \textcolor{preprocessor}{\#include <\mbox{\hyperlink{a00218}{HitStruct.h}}>}}
\DoxyCodeLine{\Hypertarget{a00011_source_l00004}00004 \textcolor{preprocessor}{\#include <\mbox{\hyperlink{a00251}{constants.h}}>}}
\DoxyCodeLine{\Hypertarget{a00011_source_l00005}00005 \textcolor{preprocessor}{\#include <\mbox{\hyperlink{a00263}{edge.h}}>}}
\DoxyCodeLine{\Hypertarget{a00011_source_l00006}00006 \textcolor{preprocessor}{\#include <\mbox{\hyperlink{a00212}{embree\_raytracer.h}}>}}
\DoxyCodeLine{\Hypertarget{a00011_source_l00007}00007 \textcolor{preprocessor}{\#include <\mbox{\hyperlink{a00239}{ray\_data.h}}>}}
\DoxyCodeLine{\Hypertarget{a00011_source_l00008}00008 \textcolor{preprocessor}{\#include <cassert>}}
\DoxyCodeLine{\Hypertarget{a00011_source_l00009}00009 }
\DoxyCodeLine{\Hypertarget{a00011_source_l00010}00010 \textcolor{keyword}{namespace }\mbox{\hyperlink{a00463}{HF::GraphGenerator}} \{}
\DoxyCodeLine{\Hypertarget{a00011_source_l00011}00011 }
\DoxyCodeLine{\Hypertarget{a00011_source_l00013}\mbox{\hyperlink{a00463_a986887183de94b00a1b8b05572da8767}{00013}}     \textcolor{keyword}{static} \textcolor{keyword}{const} \mbox{\hyperlink{a00463_a8f7754dd4958185062ba8e0bc28d6579}{real3}} \mbox{\hyperlink{a00463_a986887183de94b00a1b8b05572da8767}{down}} = \{ 0,0,-\/1 \};}
\DoxyCodeLine{\Hypertarget{a00011_source_l00014}00014 }
\DoxyCodeLine{\Hypertarget{a00011_source_l00015}00015     \textcolor{keyword}{using }\mbox{\hyperlink{a00465_a5db5f0307882796fcf7cdad83cb20c65}{HF::SpatialStructures::roundhf\_tmp}};}
\DoxyCodeLine{\Hypertarget{a00011_source_l00016}00016     \textcolor{keyword}{using }\mbox{\hyperlink{a00465_ab374c207312422f0543df4ea73f8bc85}{HF::SpatialStructures::trunchf\_tmp}};}
\DoxyCodeLine{\Hypertarget{a00011_source_l00017}00017 }
\DoxyCodeLine{\Hypertarget{a00011_source_l00018}00018     \textcolor{keyword}{using }\mbox{\hyperlink{a02071}{HF::SpatialStructures::Node}};}
\DoxyCodeLine{\Hypertarget{a00011_source_l00019}00019     \textcolor{keyword}{using }\mbox{\hyperlink{a01527}{HF::SpatialStructures::Edge}};}
\DoxyCodeLine{\Hypertarget{a00011_source_l00020}00020     \textcolor{keyword}{using }\mbox{\hyperlink{a00465_af0378d900074d484ba791d4317e5935e}{HF::SpatialStructures::STEP}};}
\DoxyCodeLine{\Hypertarget{a00011_source_l00021}00021 }
\DoxyCodeLine{\Hypertarget{a00011_source_l00022}00022     \textcolor{keyword}{using }std::vector;}
\DoxyCodeLine{\Hypertarget{a00011_source_l00023}00023 }
\DoxyCodeLine{\Hypertarget{a00011_source_l00024}00024     \textcolor{keyword}{using }\mbox{\hyperlink{a01415}{HF::RayTracer::HitStruct}};}
\DoxyCodeLine{\Hypertarget{a00011_source_l00035}00035     \textcolor{keyword}{template}<\textcolor{keyword}{typename} po\textcolor{keywordtype}{int}\_type>}
\DoxyCodeLine{\Hypertarget{a00011_source_l00036}\mbox{\hyperlink{a00463_abf1a3ae7dc89b3cf430e059a87fcd477}{00036}}     \textcolor{keyword}{inline} \mbox{\hyperlink{a02071}{Node}} \mbox{\hyperlink{a00463_abf1a3ae7dc89b3cf430e059a87fcd477}{ToNode}}(\textcolor{keyword}{const} point\_type\& ct) \{}
\DoxyCodeLine{\Hypertarget{a00011_source_l00037}00037         \textcolor{keywordflow}{return} \mbox{\hyperlink{a02071}{Node}}(ct[0], ct[1], ct[2]);}
\DoxyCodeLine{\Hypertarget{a00011_source_l00038}00038     \}}
\DoxyCodeLine{\Hypertarget{a00011_source_l00039}00039 }
\DoxyCodeLine{\Hypertarget{a00011_source_l00053}00053     \textcolor{keyword}{template}<\textcolor{keyword}{typename} n1\_type, \textcolor{keyword}{typename} n2\_type>}
\DoxyCodeLine{\Hypertarget{a00011_source_l00054}\mbox{\hyperlink{a00463_a7f96186b8f24f878404d1feccf2f64db}{00054}}     \textcolor{keyword}{inline} \mbox{\hyperlink{a00463_a6d9d3b43eebc7f05a36e6264eb08bb5a}{real\_t}} \mbox{\hyperlink{a00463_a7f96186b8f24f878404d1feccf2f64db}{DistanceTo}}(\textcolor{keyword}{const} n1\_type\& n1, \textcolor{keyword}{const} n2\_type\& n2) \{}
\DoxyCodeLine{\Hypertarget{a00011_source_l00055}00055         \textcolor{keywordflow}{return} sqrt(pow((n1[0] -\/ n2[0]), 2) + pow((n1[1] -\/ n2[1]), 2) + pow((n1[2] -\/ n2[2]), 2));}
\DoxyCodeLine{\Hypertarget{a00011_source_l00056}00056     \}}
\DoxyCodeLine{\Hypertarget{a00011_source_l00057}00057 }
\DoxyCodeLine{\Hypertarget{a00011_source_l00067}00067     \textcolor{keyword}{template}<\textcolor{keyword}{typename} vector\_type>}
\DoxyCodeLine{\Hypertarget{a00011_source_l00068}\mbox{\hyperlink{a00463_ad2e09e0825a1db4fc511907179eddf00}{00068}}     \textcolor{keyword}{inline} \textcolor{keywordtype}{void} \mbox{\hyperlink{a00463_ad2e09e0825a1db4fc511907179eddf00}{Normalize}}(vector\_type\& v) \{}
\DoxyCodeLine{\Hypertarget{a00011_source_l00069}00069         \textcolor{keyword}{auto} magnitude = sqrt(pow(v[0], 2) + pow(v[1], 2) + pow(v[2], 2));}
\DoxyCodeLine{\Hypertarget{a00011_source_l00070}00070         v[0] = v[0] / magnitude;}
\DoxyCodeLine{\Hypertarget{a00011_source_l00071}00071         v[1] = v[1] / magnitude;}
\DoxyCodeLine{\Hypertarget{a00011_source_l00072}00072         v[2] = v[2] / magnitude;}
\DoxyCodeLine{\Hypertarget{a00011_source_l00073}00073     \}}
\DoxyCodeLine{\Hypertarget{a00011_source_l00074}00074 }
\DoxyCodeLine{\Hypertarget{a00011_source_l00087}00087     \textcolor{keyword}{template}<\textcolor{keyword}{typename} vector\_type>}
\DoxyCodeLine{\Hypertarget{a00011_source_l00088}\mbox{\hyperlink{a00463_a750afc15c798c79a8b6a0784ed092f3c}{00088}}     \textcolor{keyword}{inline} vector\_type \mbox{\hyperlink{a00463_a750afc15c798c79a8b6a0784ed092f3c}{DirectionTo}}(\textcolor{keyword}{const} vector\_type\& n1, \textcolor{keyword}{const} vector\_type\& n2) \{}
\DoxyCodeLine{\Hypertarget{a00011_source_l00089}00089         vector\_type direction\_vector;}
\DoxyCodeLine{\Hypertarget{a00011_source_l00090}00090 }
\DoxyCodeLine{\Hypertarget{a00011_source_l00091}00091         direction\_vector[0] = n2[0] -\/ n1[0];}
\DoxyCodeLine{\Hypertarget{a00011_source_l00092}00092         direction\_vector[1] = n2[1] -\/ n1[1];}
\DoxyCodeLine{\Hypertarget{a00011_source_l00093}00093         direction\_vector[2] = n2[2] -\/ n1[2];}
\DoxyCodeLine{\Hypertarget{a00011_source_l00094}00094 }
\DoxyCodeLine{\Hypertarget{a00011_source_l00095}00095         \textcolor{comment}{// Normalize the vector}}
\DoxyCodeLine{\Hypertarget{a00011_source_l00096}00096         \mbox{\hyperlink{a00463_ad2e09e0825a1db4fc511907179eddf00}{Normalize}}(direction\_vector);}
\DoxyCodeLine{\Hypertarget{a00011_source_l00097}00097         \textcolor{keywordflow}{return} direction\_vector;}
\DoxyCodeLine{\Hypertarget{a00011_source_l00098}00098     \}}
\DoxyCodeLine{\Hypertarget{a00011_source_l00099}00099 }
\DoxyCodeLine{\Hypertarget{a00011_source_l00101}\mbox{\hyperlink{a00463_ad69a24044327f56034e251c25499a910}{00101}}     \textcolor{keyword}{static} \textcolor{keyword}{const} vector<pair> \mbox{\hyperlink{a00463_ad69a24044327f56034e251c25499a910}{init\_directs}} = \{}
\DoxyCodeLine{\Hypertarget{a00011_source_l00102}00102         \mbox{\hyperlink{a00463_ab618c832ef23d48d9f4ea9d9e46116dc}{pair}}(-\/1, -\/1), \mbox{\hyperlink{a00463_ab618c832ef23d48d9f4ea9d9e46116dc}{pair}}(-\/1, 0), \mbox{\hyperlink{a00463_ab618c832ef23d48d9f4ea9d9e46116dc}{pair}}(-\/1, 1),}
\DoxyCodeLine{\Hypertarget{a00011_source_l00103}00103         \mbox{\hyperlink{a00463_ab618c832ef23d48d9f4ea9d9e46116dc}{pair}}(0, -\/1), \mbox{\hyperlink{a00463_ab618c832ef23d48d9f4ea9d9e46116dc}{pair}}(0, 1), \mbox{\hyperlink{a00463_ab618c832ef23d48d9f4ea9d9e46116dc}{pair}}(1, -\/1),}
\DoxyCodeLine{\Hypertarget{a00011_source_l00104}00104         \mbox{\hyperlink{a00463_ab618c832ef23d48d9f4ea9d9e46116dc}{pair}}(1, 0), \mbox{\hyperlink{a00463_ab618c832ef23d48d9f4ea9d9e46116dc}{pair}}(1, 1)}
\DoxyCodeLine{\Hypertarget{a00011_source_l00105}00105     \};}
\DoxyCodeLine{\Hypertarget{a00011_source_l00106}00106 }
\DoxyCodeLine{\Hypertarget{a00011_source_l00107}\mbox{\hyperlink{a00463_a9ddffecb75b34434d7157b49d3c67b60}{00107}}     \mbox{\hyperlink{a01307}{optional\_real3}} \mbox{\hyperlink{a00463_a9ddffecb75b34434d7157b49d3c67b60}{ValidateStartPoint}}(\mbox{\hyperlink{a01419}{RayTracer}}\& RT, \textcolor{keyword}{const} \mbox{\hyperlink{a00463_a8f7754dd4958185062ba8e0bc28d6579}{real3}}\& start\_point, \textcolor{keyword}{const} \mbox{\hyperlink{a00463_a01303}{GraphParams}}\& Params)}
\DoxyCodeLine{\Hypertarget{a00011_source_l00108}00108     \{}
\DoxyCodeLine{\Hypertarget{a00011_source_l00109}00109         \textcolor{keywordflow}{return} \mbox{\hyperlink{a00463_a74be560268a713fc9e9b8b4a453afa2f}{CheckRay}}(RT, start\_point, \mbox{\hyperlink{a00463_a986887183de94b00a1b8b05572da8767}{down}}, Params.\mbox{\hyperlink{a00463_af7a57e8e6b17f86ac29a8df2685e56c1}{precision}}.\mbox{\hyperlink{a00463_a6ec86cb69c1cc0e0dc8ea229310939b6}{node\_z}}, \mbox{\hyperlink{a00463_a6180d5bc4bbfa9a5a426089e1f1ad598aaf146b316ade4ca80d23d9d22b0539cc}{HIT\_FLAG::FLOORS}}, Params.\mbox{\hyperlink{a00463_a5dc55aa5861e9bb2f2675146b11812af}{geom\_ids}});}
\DoxyCodeLine{\Hypertarget{a00011_source_l00110}00110     \}}
\DoxyCodeLine{\Hypertarget{a00011_source_l00111}00111 }
\DoxyCodeLine{\Hypertarget{a00011_source_l00126}\mbox{\hyperlink{a00463_ab731d597ee2a843f7b7cb1ccbae67782}{00126}}     \textcolor{keyword}{inline} \textcolor{keywordtype}{bool} \mbox{\hyperlink{a00463_ab731d597ee2a843f7b7cb1ccbae67782}{CheckGeometryID}}(\mbox{\hyperlink{a00463_a6180d5bc4bbfa9a5a426089e1f1ad598}{HIT\_FLAG}} goal, \textcolor{keywordtype}{int} \textcolor{keywordtype}{id}, \textcolor{keyword}{const} \mbox{\hyperlink{a01299}{GeometryFlagMap}} \& geom\_dict) \{}
\DoxyCodeLine{\Hypertarget{a00011_source_l00127}00127         }
\DoxyCodeLine{\Hypertarget{a00011_source_l00128}00128         \textcolor{comment}{// If the target is both or the geometry rules are set to NO\_FLAG, all hits are counted as}}
\DoxyCodeLine{\Hypertarget{a00011_source_l00129}00129         \textcolor{comment}{// being on walkable geometry}}
\DoxyCodeLine{\Hypertarget{a00011_source_l00130}00130         \textcolor{keywordflow}{if} (geom\_dict.\mbox{\hyperlink{a01299_a8284a2c40aa9b0a5db59916d32b75659}{Mode}} == \mbox{\hyperlink{a00463_af86d7be7ec8351dfc26ab5c11f727207abd38aa552d58d6dee7dc932c374f0e04}{GeometryFilterMode::ALL\_INTERSECTIONS}} || goal == \mbox{\hyperlink{a00463_a6180d5bc4bbfa9a5a426089e1f1ad598a9d20e9f6abc3d3630c75432b0dac052c}{HIT\_FLAG::BOTH}})}
\DoxyCodeLine{\Hypertarget{a00011_source_l00131}00131             \textcolor{keywordflow}{return} \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{a00011_source_l00132}00132         }
\DoxyCodeLine{\Hypertarget{a00011_source_l00133}00133         \textcolor{comment}{// Otherwise do different checks based on the ruleset}}
\DoxyCodeLine{\Hypertarget{a00011_source_l00134}00134         \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (geom\_dict.\mbox{\hyperlink{a01299_a8284a2c40aa9b0a5db59916d32b75659}{Mode}} == \mbox{\hyperlink{a00463_af86d7be7ec8351dfc26ab5c11f727207ac78656cbac82f2af0177cfe76dd1aa12}{GeometryFilterMode::OBSTACLES\_ONLY}})}
\DoxyCodeLine{\Hypertarget{a00011_source_l00135}00135             \textcolor{comment}{// If only obstacles are specified, this works like a blacklist/whitelist}}
\DoxyCodeLine{\Hypertarget{a00011_source_l00136}00136             \textcolor{keywordflow}{if} (goal == \mbox{\hyperlink{a00463_a6180d5bc4bbfa9a5a426089e1f1ad598a9118a6ea0d5aaa017a735193ac79d08d}{OBSTACLES}})}
\DoxyCodeLine{\Hypertarget{a00011_source_l00137}00137                 \textcolor{keywordflow}{return} geom\_dict[id] == \mbox{\hyperlink{a00463_a6180d5bc4bbfa9a5a426089e1f1ad598a9118a6ea0d5aaa017a735193ac79d08d}{HIT\_FLAG::OBSTACLES}};}
\DoxyCodeLine{\Hypertarget{a00011_source_l00138}00138             \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{a00011_source_l00139}00139                 \textcolor{keywordflow}{return} geom\_dict[id] != \mbox{\hyperlink{a00463_a6180d5bc4bbfa9a5a426089e1f1ad598a9118a6ea0d5aaa017a735193ac79d08d}{HIT\_FLAG::OBSTACLES}};}
\DoxyCodeLine{\Hypertarget{a00011_source_l00140}00140 }
\DoxyCodeLine{\Hypertarget{a00011_source_l00141}00141         \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (geom\_dict.\mbox{\hyperlink{a01299_a8284a2c40aa9b0a5db59916d32b75659}{Mode}} == \mbox{\hyperlink{a00463_af86d7be7ec8351dfc26ab5c11f727207adb49be99500731a1909db6bcf395d27f}{GeometryFilterMode::OBSTACLES\_AND\_FLOORS}})}
\DoxyCodeLine{\Hypertarget{a00011_source_l00142}00142             \textcolor{comment}{// In OBSTACLES\_AND\_FLOORS mode, the id's type must exactly match the goal}}
\DoxyCodeLine{\Hypertarget{a00011_source_l00143}00143             \textcolor{keywordflow}{return} (goal == geom\_dict[\textcolor{keywordtype}{id}]);}
\DoxyCodeLine{\Hypertarget{a00011_source_l00144}00144     \}}
\DoxyCodeLine{\Hypertarget{a00011_source_l00145}00145 }
\DoxyCodeLine{\Hypertarget{a00011_source_l00146}\mbox{\hyperlink{a00463_a74be560268a713fc9e9b8b4a453afa2f}{00146}}     \mbox{\hyperlink{a01307}{optional\_real3}} \mbox{\hyperlink{a00463_a74be560268a713fc9e9b8b4a453afa2f}{CheckRay}}(}
\DoxyCodeLine{\Hypertarget{a00011_source_l00147}00147         \mbox{\hyperlink{a01419}{RayTracer}}\& ray\_tracer,}
\DoxyCodeLine{\Hypertarget{a00011_source_l00148}00148         \textcolor{keyword}{const} \mbox{\hyperlink{a00463_a8f7754dd4958185062ba8e0bc28d6579}{real3}}\& origin,}
\DoxyCodeLine{\Hypertarget{a00011_source_l00149}00149         \textcolor{keyword}{const} \mbox{\hyperlink{a00463_a8f7754dd4958185062ba8e0bc28d6579}{real3}}\& direction,}
\DoxyCodeLine{\Hypertarget{a00011_source_l00150}00150         \mbox{\hyperlink{a00463_a6d9d3b43eebc7f05a36e6264eb08bb5a}{real\_t}} node\_z\_tolerance,}
\DoxyCodeLine{\Hypertarget{a00011_source_l00151}00151         \mbox{\hyperlink{a00463_a6180d5bc4bbfa9a5a426089e1f1ad598}{HIT\_FLAG}} flag,}
\DoxyCodeLine{\Hypertarget{a00011_source_l00152}00152         \textcolor{keyword}{const} \mbox{\hyperlink{a01299}{GeometryFlagMap}} \& geometry\_dict)}
\DoxyCodeLine{\Hypertarget{a00011_source_l00153}00153     \{}
\DoxyCodeLine{\Hypertarget{a00011_source_l00154}00154         \textcolor{comment}{// Setup default params}}
\DoxyCodeLine{\Hypertarget{a00011_source_l00155}00155         \mbox{\hyperlink{a01415}{HitStruct<real\_t>}} res;}
\DoxyCodeLine{\Hypertarget{a00011_source_l00156}00156 }
\DoxyCodeLine{\Hypertarget{a00011_source_l00157}00157         \textcolor{comment}{// Cast the ray. On success, this returns the ID and distance to intersection.}}
\DoxyCodeLine{\Hypertarget{a00011_source_l00158}00158         res = ray\_tracer.\mbox{\hyperlink{a01419_a7ee672618f7fe9ce6938978d93d18514}{Intersect}}(origin, direction);}
\DoxyCodeLine{\Hypertarget{a00011_source_l00159}00159 }
\DoxyCodeLine{\Hypertarget{a00011_source_l00160}00160         \textcolor{comment}{// Check if it hit and the ID of the geometry matches what we were looking for. }}
\DoxyCodeLine{\Hypertarget{a00011_source_l00161}00161         \textcolor{keywordflow}{if} (res.\mbox{\hyperlink{a01415_a3d86c2c8d8e0ec6bf63a653ec89807a8}{DidHit}}() \&\& \mbox{\hyperlink{a00463_ab731d597ee2a843f7b7cb1ccbae67782}{CheckGeometryID}}(flag, res.\mbox{\hyperlink{a01415_a7c49a19e480ba9797c9da3d2acd2221d}{meshid}}, geometry\_dict)) \{}
\DoxyCodeLine{\Hypertarget{a00011_source_l00162}00162             \textcolor{comment}{// Create a new optional point with a copy of the origin}}
\DoxyCodeLine{\Hypertarget{a00011_source_l00163}00163             \mbox{\hyperlink{a01307}{optional\_real3}} return\_pt(origin);}
\DoxyCodeLine{\Hypertarget{a00011_source_l00164}00164 }
\DoxyCodeLine{\Hypertarget{a00011_source_l00165}00165             \textcolor{comment}{// Move it in direction}}
\DoxyCodeLine{\Hypertarget{a00011_source_l00166}00166             \mbox{\hyperlink{a00463_a5ad3e8fac4a21eee744f3633f7a3692f}{MoveNode}}(res.\mbox{\hyperlink{a01415_a6fbe94ce3a7514a37415d28ff0500b64}{distance}}, direction, *return\_pt);}
\DoxyCodeLine{\Hypertarget{a00011_source_l00167}00167             \textcolor{comment}{//double temp\_diff = (origin[2]) -\/ dist; // Sanity check for direction -\/1 to see influence of movenode arithmetic }}
\DoxyCodeLine{\Hypertarget{a00011_source_l00168}00168             \textcolor{comment}{// Round the position to the z value tolerance}}
\DoxyCodeLine{\Hypertarget{a00011_source_l00169}00169             return\_pt.\mbox{\hyperlink{a01307_a1c21b3590d2f9d2327cfc4d7c1a11521}{pt}}[2] = HF::SpatialStructures::roundhf\_tail<real\_t>(return\_pt.\mbox{\hyperlink{a01307_a1c21b3590d2f9d2327cfc4d7c1a11521}{pt}}[2], 1/node\_z\_tolerance);}
\DoxyCodeLine{\Hypertarget{a00011_source_l00170}00170 }
\DoxyCodeLine{\Hypertarget{a00011_source_l00171}00171             \textcolor{comment}{// Return the optional point}}
\DoxyCodeLine{\Hypertarget{a00011_source_l00172}00172             \textcolor{keywordflow}{return} return\_pt;}
\DoxyCodeLine{\Hypertarget{a00011_source_l00173}00173         \}}
\DoxyCodeLine{\Hypertarget{a00011_source_l00174}00174 }
\DoxyCodeLine{\Hypertarget{a00011_source_l00175}00175         \textcolor{comment}{// Otherwise, return an empty optional\_real3 to signal that}}
\DoxyCodeLine{\Hypertarget{a00011_source_l00176}00176         \textcolor{comment}{// the point didn't intersect}}
\DoxyCodeLine{\Hypertarget{a00011_source_l00177}00177         \textcolor{keywordflow}{return} \mbox{\hyperlink{a01307}{optional\_real3}}();}
\DoxyCodeLine{\Hypertarget{a00011_source_l00178}00178     \}}
\DoxyCodeLine{\Hypertarget{a00011_source_l00179}00179 }
\DoxyCodeLine{\Hypertarget{a00011_source_l00180}\mbox{\hyperlink{a00463_afe5670b4cb780fd3ccf2a0d72a2e3c2e}{00180}}     std::set<std::pair<int, int>> \mbox{\hyperlink{a00463_afe5670b4cb780fd3ccf2a0d72a2e3c2e}{permutations}}(\textcolor{keywordtype}{int} limit) \{}
\DoxyCodeLine{\Hypertarget{a00011_source_l00181}00181         \textcolor{comment}{// Create a vector of all numbers between 1 and limit + 1, as well as their inverses}}
\DoxyCodeLine{\Hypertarget{a00011_source_l00182}00182         vector<int> steps;}
\DoxyCodeLine{\Hypertarget{a00011_source_l00183}00183         steps.reserve(2 * limit);}
\DoxyCodeLine{\Hypertarget{a00011_source_l00184}00184 }
\DoxyCodeLine{\Hypertarget{a00011_source_l00185}00185         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i = 1; i < limit + 1; i++) \{}
\DoxyCodeLine{\Hypertarget{a00011_source_l00186}00186             steps.push\_back(i);}
\DoxyCodeLine{\Hypertarget{a00011_source_l00187}00187             steps.push\_back(-\/i);}
\DoxyCodeLine{\Hypertarget{a00011_source_l00188}00188         \}}
\DoxyCodeLine{\Hypertarget{a00011_source_l00189}00189 }
\DoxyCodeLine{\Hypertarget{a00011_source_l00190}00190         std::set<std::pair<int, int>> perms;}
\DoxyCodeLine{\Hypertarget{a00011_source_l00191}00191 }
\DoxyCodeLine{\Hypertarget{a00011_source_l00192}00192         \textcolor{comment}{// Nest a for loop to capture every permutation}}
\DoxyCodeLine{\Hypertarget{a00011_source_l00193}00193         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} j : steps)}
\DoxyCodeLine{\Hypertarget{a00011_source_l00194}00194             \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} k : steps)}
\DoxyCodeLine{\Hypertarget{a00011_source_l00195}00195                 \textcolor{keywordflow}{if} (abs(j) != abs(k))}
\DoxyCodeLine{\Hypertarget{a00011_source_l00196}00196                     perms.emplace(\mbox{\hyperlink{a00463_ab618c832ef23d48d9f4ea9d9e46116dc}{pair}}(j, k));}
\DoxyCodeLine{\Hypertarget{a00011_source_l00197}00197 }
\DoxyCodeLine{\Hypertarget{a00011_source_l00198}00198         \textcolor{keywordflow}{return} perms;}
\DoxyCodeLine{\Hypertarget{a00011_source_l00199}00199     \}}
\DoxyCodeLine{\Hypertarget{a00011_source_l00200}00200 }
\DoxyCodeLine{\Hypertarget{a00011_source_l00201}\mbox{\hyperlink{a00463_aefd344ebb2faadc64a56a16dc8582026}{00201}}     vector<pair> \mbox{\hyperlink{a00463_aefd344ebb2faadc64a56a16dc8582026}{CreateDirecs}}(\textcolor{keywordtype}{int} max\_step\_connections) \{}
\DoxyCodeLine{\Hypertarget{a00011_source_l00202}00202         \textcolor{comment}{// A max\_step\_connections of 1 is just init\_directs}}
\DoxyCodeLine{\Hypertarget{a00011_source_l00203}00203         \textcolor{keywordflow}{if} (max\_step\_connections == 1) \textcolor{keywordflow}{return} \mbox{\hyperlink{a00463_ad69a24044327f56034e251c25499a910}{init\_directs}};}
\DoxyCodeLine{\Hypertarget{a00011_source_l00204}00204 }
\DoxyCodeLine{\Hypertarget{a00011_source_l00205}00205         \textcolor{comment}{// Otherwise generate extra directions}}
\DoxyCodeLine{\Hypertarget{a00011_source_l00206}00206         \textcolor{keyword}{auto} perms = \mbox{\hyperlink{a00463_afe5670b4cb780fd3ccf2a0d72a2e3c2e}{permutations}}(max\_step\_connections);}
\DoxyCodeLine{\Hypertarget{a00011_source_l00207}00207 }
\DoxyCodeLine{\Hypertarget{a00011_source_l00208}00208         \textcolor{comment}{// Copy init\_directs into our output array}}
\DoxyCodeLine{\Hypertarget{a00011_source_l00209}00209         vector<pair> out\_directions = \mbox{\hyperlink{a00463_ad69a24044327f56034e251c25499a910}{init\_directs}};}
\DoxyCodeLine{\Hypertarget{a00011_source_l00210}00210 }
\DoxyCodeLine{\Hypertarget{a00011_source_l00211}00211         \textcolor{comment}{// Resize our output array to fit the new permutations, then fill it}}
\DoxyCodeLine{\Hypertarget{a00011_source_l00212}00212         out\_directions.resize(out\_directions.size() + perms.size());}
\DoxyCodeLine{\Hypertarget{a00011_source_l00213}00213         std::move(perms.begin(), perms.end(), out\_directions.begin() + \mbox{\hyperlink{a00463_ad69a24044327f56034e251c25499a910}{init\_directs}}.size());}
\DoxyCodeLine{\Hypertarget{a00011_source_l00214}00214 }
\DoxyCodeLine{\Hypertarget{a00011_source_l00215}00215         \textcolor{keywordflow}{return} out\_directions;}
\DoxyCodeLine{\Hypertarget{a00011_source_l00216}00216     \}}
\DoxyCodeLine{\Hypertarget{a00011_source_l00217}00217 }
\DoxyCodeLine{\Hypertarget{a00011_source_l00218}\mbox{\hyperlink{a00463_ab7ffcc7d6657ce276c06deed24c546a4}{00218}}     vector<graph\_edge> \mbox{\hyperlink{a00463_ab7ffcc7d6657ce276c06deed24c546a4}{GetChildren}}(}
\DoxyCodeLine{\Hypertarget{a00011_source_l00219}00219         \textcolor{keyword}{const} \mbox{\hyperlink{a00463_a8f7754dd4958185062ba8e0bc28d6579}{real3}}\& parent,}
\DoxyCodeLine{\Hypertarget{a00011_source_l00220}00220         \textcolor{keyword}{const} vector<real3>\& possible\_children,}
\DoxyCodeLine{\Hypertarget{a00011_source_l00221}00221         \mbox{\hyperlink{a01419}{RayTracer}}\& rt,}
\DoxyCodeLine{\Hypertarget{a00011_source_l00222}00222         \textcolor{keyword}{const} \mbox{\hyperlink{a00463_a01303}{GraphParams}}\& GP}
\DoxyCodeLine{\Hypertarget{a00011_source_l00223}00223         )}
\DoxyCodeLine{\Hypertarget{a00011_source_l00224}00224     \{}
\DoxyCodeLine{\Hypertarget{a00011_source_l00225}00225         std::vector<graph\_edge> valid\_edges;}
\DoxyCodeLine{\Hypertarget{a00011_source_l00226}00226 }
\DoxyCodeLine{\Hypertarget{a00011_source_l00227}00227         \textcolor{comment}{// Call CheckChildren to get rid of all children that aren't over valid ground or don't meet our upstep}}
\DoxyCodeLine{\Hypertarget{a00011_source_l00228}00228         \textcolor{comment}{// and downstep requirements. This array of children will also be moved directly ontop of the ground their over.}}
\DoxyCodeLine{\Hypertarget{a00011_source_l00229}00229         \textcolor{keyword}{const} \textcolor{keyword}{auto} checked\_children = \mbox{\hyperlink{a00463_a4b7cc0ad0002975404acef5064f4f546}{CheckChildren}}(parent, possible\_children, rt, GP);}
\DoxyCodeLine{\Hypertarget{a00011_source_l00230}00230 }
\DoxyCodeLine{\Hypertarget{a00011_source_l00231}00231         \textcolor{comment}{// Iterate through every child in the checked children}}
\DoxyCodeLine{\Hypertarget{a00011_source_l00232}00232         \textcolor{keywordflow}{for} (\textcolor{keyword}{const} \textcolor{keyword}{auto}\& child : checked\_children)}
\DoxyCodeLine{\Hypertarget{a00011_source_l00233}00233         \{}
\DoxyCodeLine{\Hypertarget{a00011_source_l00234}00234             \textcolor{comment}{// Determine the type of connection between the parent and child}}
\DoxyCodeLine{\Hypertarget{a00011_source_l00235}00235             \textcolor{comment}{//  including if it is a step, slope, or not connected}}
\DoxyCodeLine{\Hypertarget{a00011_source_l00236}00236             \textcolor{keyword}{const} STEP connection\_type = \mbox{\hyperlink{a00463_a260a25e02193ce904849ee090daefa2e}{CheckConnection}}(parent, child, rt, GP);}
\DoxyCodeLine{\Hypertarget{a00011_source_l00237}00237 }
\DoxyCodeLine{\Hypertarget{a00011_source_l00238}00238             \textcolor{comment}{// If the node is connected Add it to out list of valid children}}
\DoxyCodeLine{\Hypertarget{a00011_source_l00239}00239             \textcolor{keywordflow}{if} (connection\_type != STEP::NOT\_CONNECTED)}
\DoxyCodeLine{\Hypertarget{a00011_source_l00240}00240             \{}
\DoxyCodeLine{\Hypertarget{a00011_source_l00241}00241                 \textcolor{comment}{// Add the edge to the array of children, storing the distance and connection type}}
\DoxyCodeLine{\Hypertarget{a00011_source_l00242}00242                 valid\_edges.emplace\_back(\mbox{\hyperlink{a00463_a2472e370aa77f9486bb1c46a1ff704c5}{graph\_edge}}(\mbox{\hyperlink{a00463_abf1a3ae7dc89b3cf430e059a87fcd477}{ToNode}}(child), \mbox{\hyperlink{a00463_a7f96186b8f24f878404d1feccf2f64db}{DistanceTo}}(parent, child), connection\_type));}
\DoxyCodeLine{\Hypertarget{a00011_source_l00243}00243             \}}
\DoxyCodeLine{\Hypertarget{a00011_source_l00244}00244         \}}
\DoxyCodeLine{\Hypertarget{a00011_source_l00245}00245         \textcolor{keywordflow}{return} valid\_edges;}
\DoxyCodeLine{\Hypertarget{a00011_source_l00246}00246     \}}
\DoxyCodeLine{\Hypertarget{a00011_source_l00247}00247 }
\DoxyCodeLine{\Hypertarget{a00011_source_l00248}\mbox{\hyperlink{a00463_a4b7cc0ad0002975404acef5064f4f546}{00248}}     std::vector<real3> \mbox{\hyperlink{a00463_a4b7cc0ad0002975404acef5064f4f546}{CheckChildren}}(}
\DoxyCodeLine{\Hypertarget{a00011_source_l00249}00249         \textcolor{keyword}{const} \mbox{\hyperlink{a00463_a8f7754dd4958185062ba8e0bc28d6579}{real3}}\& parent,}
\DoxyCodeLine{\Hypertarget{a00011_source_l00250}00250         \textcolor{keyword}{const} std::vector<real3>\& possible\_children,}
\DoxyCodeLine{\Hypertarget{a00011_source_l00251}00251         \mbox{\hyperlink{a01419}{RayTracer}}\& rt,}
\DoxyCodeLine{\Hypertarget{a00011_source_l00252}00252         \textcolor{keyword}{const} \mbox{\hyperlink{a00463_a01303}{GraphParams}}\& GP)}
\DoxyCodeLine{\Hypertarget{a00011_source_l00253}00253     \{}
\DoxyCodeLine{\Hypertarget{a00011_source_l00254}00254         vector<real3> valid\_children;}
\DoxyCodeLine{\Hypertarget{a00011_source_l00255}00255 }
\DoxyCodeLine{\Hypertarget{a00011_source_l00256}00256         \textcolor{comment}{// Iterate through every child in the set of possible children}}
\DoxyCodeLine{\Hypertarget{a00011_source_l00257}00257         \textcolor{keywordflow}{for} (\textcolor{keyword}{const} \textcolor{keyword}{auto}\& child : possible\_children)}
\DoxyCodeLine{\Hypertarget{a00011_source_l00258}00258         \{}
\DoxyCodeLine{\Hypertarget{a00011_source_l00259}00259 }
\DoxyCodeLine{\Hypertarget{a00011_source_l00260}00260             \textcolor{comment}{// Check if a ray intersects a mesh}}
\DoxyCodeLine{\Hypertarget{a00011_source_l00261}00261             \mbox{\hyperlink{a01307}{optional\_real3}} potential\_child = \mbox{\hyperlink{a00463_a74be560268a713fc9e9b8b4a453afa2f}{CheckRay}}(rt, child, \mbox{\hyperlink{a00463_a986887183de94b00a1b8b05572da8767}{down}}, GP.\mbox{\hyperlink{a00463_af7a57e8e6b17f86ac29a8df2685e56c1}{precision}}.\mbox{\hyperlink{a00463_a6ec86cb69c1cc0e0dc8ea229310939b6}{node\_z}}, \mbox{\hyperlink{a00463_a6180d5bc4bbfa9a5a426089e1f1ad598aaf146b316ade4ca80d23d9d22b0539cc}{HIT\_FLAG::FLOORS}}, GP.\mbox{\hyperlink{a00463_a5dc55aa5861e9bb2f2675146b11812af}{geom\_ids}});}
\DoxyCodeLine{\Hypertarget{a00011_source_l00262}00262             }
\DoxyCodeLine{\Hypertarget{a00011_source_l00263}00263             \textcolor{keywordflow}{if} (potential\_child)}
\DoxyCodeLine{\Hypertarget{a00011_source_l00264}00264             \{}
\DoxyCodeLine{\Hypertarget{a00011_source_l00265}00265                 \textcolor{comment}{// Get a reference to the child in the return value now that we know it's over valid ground}}
\DoxyCodeLine{\Hypertarget{a00011_source_l00266}00266                 \textcolor{keyword}{auto}\& confirmed\_child = potential\_child.\mbox{\hyperlink{a01307_a1c21b3590d2f9d2327cfc4d7c1a11521}{pt}};}
\DoxyCodeLine{\Hypertarget{a00011_source_l00267}00267 }
\DoxyCodeLine{\Hypertarget{a00011_source_l00268}00268                 \textcolor{comment}{// TODO: this is a premature check and should be moved to the original calling function}}
\DoxyCodeLine{\Hypertarget{a00011_source_l00269}00269                 \textcolor{comment}{//      after the step type check since upstep and downstep are parameters for stepping and not slope}}
\DoxyCodeLine{\Hypertarget{a00011_source_l00270}00270 }
\DoxyCodeLine{\Hypertarget{a00011_source_l00271}00271                 \textcolor{comment}{// Check to see if the new position will satisfy up and downstep restrictions}}
\DoxyCodeLine{\Hypertarget{a00011_source_l00272}00272                 \mbox{\hyperlink{a00463_a6d9d3b43eebc7f05a36e6264eb08bb5a}{real\_t}} dstep = parent[2] -\/ confirmed\_child[2];}
\DoxyCodeLine{\Hypertarget{a00011_source_l00273}00273                 \mbox{\hyperlink{a00463_a6d9d3b43eebc7f05a36e6264eb08bb5a}{real\_t}} ustep = confirmed\_child[2] -\/ parent[2];}
\DoxyCodeLine{\Hypertarget{a00011_source_l00274}00274 }
\DoxyCodeLine{\Hypertarget{a00011_source_l00275}00275 }
\DoxyCodeLine{\Hypertarget{a00011_source_l00276}00276                 \textcolor{keywordflow}{if} (dstep < GP.\mbox{\hyperlink{a00463_add2b6fa6bf77a8c4626a1e6d0559970f}{down\_step}} \&\& ustep < GP.\mbox{\hyperlink{a00463_a0b8afc5f531e3286ce2434b1bc2b1f50}{up\_step}})}
\DoxyCodeLine{\Hypertarget{a00011_source_l00277}00277                     valid\_children.push\_back(confirmed\_child);}
\DoxyCodeLine{\Hypertarget{a00011_source_l00278}00278             \}}
\DoxyCodeLine{\Hypertarget{a00011_source_l00279}00279         \}}
\DoxyCodeLine{\Hypertarget{a00011_source_l00280}00280         \textcolor{keywordflow}{return} valid\_children;}
\DoxyCodeLine{\Hypertarget{a00011_source_l00281}00281     \}}
\DoxyCodeLine{\Hypertarget{a00011_source_l00282}00282 }
\DoxyCodeLine{\Hypertarget{a00011_source_l00283}\mbox{\hyperlink{a00463_ace66c1b60785c32433402f012019ab81}{00283}}     \textcolor{keywordtype}{bool} \mbox{\hyperlink{a00463_ace66c1b60785c32433402f012019ab81}{OcclusionCheck}}(\textcolor{keyword}{const} \mbox{\hyperlink{a00463_a8f7754dd4958185062ba8e0bc28d6579}{real3}}\& parent, \textcolor{keyword}{const} \mbox{\hyperlink{a00463_a8f7754dd4958185062ba8e0bc28d6579}{real3}}\& child, \mbox{\hyperlink{a01419}{RayTracer}}\& RT)}
\DoxyCodeLine{\Hypertarget{a00011_source_l00284}00284     \{}
\DoxyCodeLine{\Hypertarget{a00011_source_l00285}00285         \textcolor{comment}{// Use the distance between parent and child}}
\DoxyCodeLine{\Hypertarget{a00011_source_l00286}00286         \textcolor{comment}{// as the maximum distance for the occlusion check}}
\DoxyCodeLine{\Hypertarget{a00011_source_l00287}00287         \textcolor{keywordflow}{return} RT.\mbox{\hyperlink{a01419_a22ebf97e859ef651e81deb40b74f668f}{Occluded}}(parent, \mbox{\hyperlink{a00463_a750afc15c798c79a8b6a0784ed092f3c}{DirectionTo}}(parent, child), \mbox{\hyperlink{a00463_a7f96186b8f24f878404d1feccf2f64db}{DistanceTo}}(parent, child));}
\DoxyCodeLine{\Hypertarget{a00011_source_l00288}00288     \}}
\DoxyCodeLine{\Hypertarget{a00011_source_l00289}00289 }
\DoxyCodeLine{\Hypertarget{a00011_source_l00290}\mbox{\hyperlink{a00463_a9daa85cb56a1b18d44f46aa9c420afde}{00290}}     \textcolor{keywordtype}{bool} \mbox{\hyperlink{a00463_a9daa85cb56a1b18d44f46aa9c420afde}{CheckSlope}}(\textcolor{keyword}{const} \mbox{\hyperlink{a00463_a8f7754dd4958185062ba8e0bc28d6579}{real3}}\& parent, \textcolor{keyword}{const} \mbox{\hyperlink{a00463_a8f7754dd4958185062ba8e0bc28d6579}{real3}}\& child, \textcolor{keyword}{const} \mbox{\hyperlink{a00463_a01303}{GraphParams}}\& gp)}
\DoxyCodeLine{\Hypertarget{a00011_source_l00291}00291     \{}
\DoxyCodeLine{\Hypertarget{a00011_source_l00292}00292         \textcolor{comment}{// Slope is rise/run}}
\DoxyCodeLine{\Hypertarget{a00011_source_l00293}00293         \textcolor{keyword}{const} \mbox{\hyperlink{a00463_a6d9d3b43eebc7f05a36e6264eb08bb5a}{real\_t}} run = sqrt(pow((parent[0] -\/ child[0]), 2) + pow((parent[1] -\/ child[1]), 2));}
\DoxyCodeLine{\Hypertarget{a00011_source_l00294}00294         \textcolor{keyword}{const} \mbox{\hyperlink{a00463_a6d9d3b43eebc7f05a36e6264eb08bb5a}{real\_t}} rise = child[2] -\/ parent[2];}
\DoxyCodeLine{\Hypertarget{a00011_source_l00295}00295 }
\DoxyCodeLine{\Hypertarget{a00011_source_l00296}00296         \textcolor{comment}{// Calculate the angle between rise and run.}}
\DoxyCodeLine{\Hypertarget{a00011_source_l00297}00297         \textcolor{keyword}{const} \mbox{\hyperlink{a00463_a6d9d3b43eebc7f05a36e6264eb08bb5a}{real\_t}} calc\_slope = atan2(rise, run) * (\textcolor{keyword}{static\_cast<}\mbox{\hyperlink{a00463_a6d9d3b43eebc7f05a36e6264eb08bb5a}{real\_t}}\textcolor{keyword}{>}(180.00) / \textcolor{keyword}{static\_cast<}\mbox{\hyperlink{a00463_a6d9d3b43eebc7f05a36e6264eb08bb5a}{real\_t}}\textcolor{keyword}{>}(M\_PI));}
\DoxyCodeLine{\Hypertarget{a00011_source_l00298}00298 }
\DoxyCodeLine{\Hypertarget{a00011_source_l00299}00299         \textcolor{comment}{// Check against downslope and upslope.}}
\DoxyCodeLine{\Hypertarget{a00011_source_l00300}00300         \textcolor{keywordflow}{return} calc\_slope > -\/1.0 * gp.\mbox{\hyperlink{a00463_a7c141d33285a77c81fc1b9ce0b210d72}{down\_slope}} \&\& calc\_slope < gp.\mbox{\hyperlink{a00463_add7f080950668f5dfa8d857e9c66b89d}{up\_slope}};}
\DoxyCodeLine{\Hypertarget{a00011_source_l00301}00301     \}}
\DoxyCodeLine{\Hypertarget{a00011_source_l00302}00302 }
\DoxyCodeLine{\Hypertarget{a00011_source_l00303}\mbox{\hyperlink{a00463_a176c58b25fb5cb545d17128d4535f921}{00303}}     \mbox{\hyperlink{a01535}{HF::SpatialStructures::EdgeSet}} \mbox{\hyperlink{a00463_a176c58b25fb5cb545d17128d4535f921}{CalculateStepType}}(\textcolor{keyword}{const} \mbox{\hyperlink{a00465_a01543}{HF::SpatialStructures::Subgraph}}\& sg, \mbox{\hyperlink{a01419}{HF::RayTracer::MultiRT}}\& rt) \{}
\DoxyCodeLine{\Hypertarget{a00011_source_l00304}00304         \textcolor{comment}{// Step type will be stored here and returned from this function}}
\DoxyCodeLine{\Hypertarget{a00011_source_l00305}00305 }
\DoxyCodeLine{\Hypertarget{a00011_source_l00306}00306         \textcolor{comment}{//Initialize output}}
\DoxyCodeLine{\Hypertarget{a00011_source_l00307}00307         std::vector<HF::SpatialStructures::EdgeSet> edge\_set;}
\DoxyCodeLine{\Hypertarget{a00011_source_l00308}00308 }
\DoxyCodeLine{\Hypertarget{a00011_source_l00309}00309         \textcolor{comment}{//From Subgraph sg}}
\DoxyCodeLine{\Hypertarget{a00011_source_l00310}00310         \mbox{\hyperlink{a02071}{Node}} parent\_node = sg.\mbox{\hyperlink{a00465_a2f8de99f10387d075d7d69336e4d5dd7}{m\_parent}};}
\DoxyCodeLine{\Hypertarget{a00011_source_l00311}00311         std::vector<Edge> edge\_list = sg.\mbox{\hyperlink{a00465_ac1403ade5ddeb5410a523871f96e1e64}{m\_edges}};}
\DoxyCodeLine{\Hypertarget{a00011_source_l00312}00312 }
\DoxyCodeLine{\Hypertarget{a00011_source_l00313}00313         \textcolor{comment}{// We can preallocate this container to have edge\_list.size()}}
\DoxyCodeLine{\Hypertarget{a00011_source_l00314}00314         \textcolor{comment}{// blocks since we know how many children are in the subgraph.}}
\DoxyCodeLine{\Hypertarget{a00011_source_l00315}00315         std::vector<HF::SpatialStructures::IntEdge> children(edge\_list.size());}
\DoxyCodeLine{\Hypertarget{a00011_source_l00316}00316         \textcolor{keyword}{auto} it\_children = children.begin();}
\DoxyCodeLine{\Hypertarget{a00011_source_l00317}00317 }
\DoxyCodeLine{\Hypertarget{a00011_source_l00318}00318         \textcolor{comment}{//For every edge...}}
\DoxyCodeLine{\Hypertarget{a00011_source_l00319}00319         \textcolor{keywordflow}{for} (\mbox{\hyperlink{a01527}{Edge}} link\_a : edge\_list) \{}
\DoxyCodeLine{\Hypertarget{a00011_source_l00320}00320             \mbox{\hyperlink{a02071}{Node}} curr\_child = link\_a.child;}
\DoxyCodeLine{\Hypertarget{a00011_source_l00321}00321 }
\DoxyCodeLine{\Hypertarget{a00011_source_l00322}00322             \textcolor{comment}{//Type Casting}}
\DoxyCodeLine{\Hypertarget{a00011_source_l00323}00323             \mbox{\hyperlink{a00463_a6d9d3b43eebc7f05a36e6264eb08bb5a}{real\_t}} parent\_x = \mbox{\hyperlink{a00463_a73b53db067a504d36e9481dfe3326b60}{CastToReal}}(parent\_node.\mbox{\hyperlink{a02071_a78dfebaa44da09b03d7ca15445c8d222}{x}});}
\DoxyCodeLine{\Hypertarget{a00011_source_l00324}00324             \mbox{\hyperlink{a00463_a6d9d3b43eebc7f05a36e6264eb08bb5a}{real\_t}} parent\_y = \mbox{\hyperlink{a00463_a73b53db067a504d36e9481dfe3326b60}{CastToReal}}(parent\_node.\mbox{\hyperlink{a02071_a41981fb2cc6dc0edb787f921188702b0}{y}});}
\DoxyCodeLine{\Hypertarget{a00011_source_l00325}00325             \mbox{\hyperlink{a00463_a6d9d3b43eebc7f05a36e6264eb08bb5a}{real\_t}} parent\_z = \mbox{\hyperlink{a00463_a73b53db067a504d36e9481dfe3326b60}{CastToReal}}(parent\_node.\mbox{\hyperlink{a02071_a495b47689917e0395ce96ee01d3f5ed3}{z}});}
\DoxyCodeLine{\Hypertarget{a00011_source_l00326}00326 }
\DoxyCodeLine{\Hypertarget{a00011_source_l00327}00327             \mbox{\hyperlink{a00463_a6d9d3b43eebc7f05a36e6264eb08bb5a}{real\_t}} child\_x = \mbox{\hyperlink{a00463_a73b53db067a504d36e9481dfe3326b60}{CastToReal}}(curr\_child.\mbox{\hyperlink{a02071_a78dfebaa44da09b03d7ca15445c8d222}{x}});}
\DoxyCodeLine{\Hypertarget{a00011_source_l00328}00328             \mbox{\hyperlink{a00463_a6d9d3b43eebc7f05a36e6264eb08bb5a}{real\_t}} child\_y = \mbox{\hyperlink{a00463_a73b53db067a504d36e9481dfe3326b60}{CastToReal}}(curr\_child.\mbox{\hyperlink{a02071_a41981fb2cc6dc0edb787f921188702b0}{y}});}
\DoxyCodeLine{\Hypertarget{a00011_source_l00329}00329             \mbox{\hyperlink{a00463_a6d9d3b43eebc7f05a36e6264eb08bb5a}{real\_t}} child\_z = \mbox{\hyperlink{a00463_a73b53db067a504d36e9481dfe3326b60}{CastToReal}}(curr\_child.\mbox{\hyperlink{a02071_a495b47689917e0395ce96ee01d3f5ed3}{z}});}
\DoxyCodeLine{\Hypertarget{a00011_source_l00330}00330 }
\DoxyCodeLine{\Hypertarget{a00011_source_l00331}00331             std::vector<real\_t> parent\_loc = \{ parent\_x, parent\_y, parent\_z \};}
\DoxyCodeLine{\Hypertarget{a00011_source_l00332}00332             std::vector<real\_t> child\_loc = \{ child\_x, child\_y, child\_z \};}
\DoxyCodeLine{\Hypertarget{a00011_source_l00333}00333 }
\DoxyCodeLine{\Hypertarget{a00011_source_l00334}00334             \mbox{\hyperlink{a00463_a8f7754dd4958185062ba8e0bc28d6579}{real3}} parent\_cast = \mbox{\hyperlink{a00463_a58892abe1152c28d26d3ca749c99ea4d}{CastToReal3}}(parent\_loc);}
\DoxyCodeLine{\Hypertarget{a00011_source_l00335}00335             \mbox{\hyperlink{a00463_a8f7754dd4958185062ba8e0bc28d6579}{real3}} child\_cast = \mbox{\hyperlink{a00463_a58892abe1152c28d26d3ca749c99ea4d}{CastToReal3}}(child\_loc);}
\DoxyCodeLine{\Hypertarget{a00011_source_l00336}00336 }
\DoxyCodeLine{\Hypertarget{a00011_source_l00337}00337             \textcolor{comment}{//Get the step type between parent and child}}
\DoxyCodeLine{\Hypertarget{a00011_source_l00338}00338             STEP step\_type = \mbox{\hyperlink{a00463_a260a25e02193ce904849ee090daefa2e}{CheckConnection}}(parent\_cast, child\_cast, rt);}
\DoxyCodeLine{\Hypertarget{a00011_source_l00339}00339 }
\DoxyCodeLine{\Hypertarget{a00011_source_l00340}00340             \textcolor{comment}{//Construct an intedge for this parent-\/child pair to add to edgeset}}
\DoxyCodeLine{\Hypertarget{a00011_source_l00341}00341             \mbox{\hyperlink{a01531}{HF::SpatialStructures::IntEdge}} ie = \{ link\_a.\mbox{\hyperlink{a01531_a7662d9deb8c69743b37c0c8da3f51610}{child}}.id, \textcolor{keyword}{static\_cast<}\textcolor{keywordtype}{float}\textcolor{keyword}{>}(step\_type) \};}
\DoxyCodeLine{\Hypertarget{a00011_source_l00342}00342 }
\DoxyCodeLine{\Hypertarget{a00011_source_l00343}00343             *(it\_children++) = ie;}
\DoxyCodeLine{\Hypertarget{a00011_source_l00344}00344         \}}
\DoxyCodeLine{\Hypertarget{a00011_source_l00345}00345 }
\DoxyCodeLine{\Hypertarget{a00011_source_l00346}00346         \mbox{\hyperlink{a01535}{HF::SpatialStructures::EdgeSet}} es = \{ parent\_node.\mbox{\hyperlink{a02071_a8212d00e6913abf0ca6fec1f2624b677}{id}}, children \};}
\DoxyCodeLine{\Hypertarget{a00011_source_l00347}00347 }
\DoxyCodeLine{\Hypertarget{a00011_source_l00348}00348         \textcolor{keywordflow}{return} es;}
\DoxyCodeLine{\Hypertarget{a00011_source_l00349}00349     \}}
\DoxyCodeLine{\Hypertarget{a00011_source_l00350}00350 }
\DoxyCodeLine{\Hypertarget{a00011_source_l00351}\mbox{\hyperlink{a00463_a81398de53e151ae58b206523e555309e}{00351}}     std::vector<HF::SpatialStructures::EdgeSet> \mbox{\hyperlink{a00463_a176c58b25fb5cb545d17128d4535f921}{CalculateStepType}}(\textcolor{keyword}{const} \mbox{\hyperlink{a01551}{HF::SpatialStructures::Graph}}\& g, \mbox{\hyperlink{a01419}{HF::RayTracer::MultiRT}}\& rt) \{}
\DoxyCodeLine{\Hypertarget{a00011_source_l00352}00352         \textcolor{comment}{// Retrieve all nodes from g so we can obtain subgraphs.}}
\DoxyCodeLine{\Hypertarget{a00011_source_l00353}00353         std::vector<HF::SpatialStructures::Node> nodes = g.\mbox{\hyperlink{a01551_aa70347b8a33b57c6f0a72d6eca4248d7}{Nodes}}();}
\DoxyCodeLine{\Hypertarget{a00011_source_l00354}00354 }
\DoxyCodeLine{\Hypertarget{a00011_source_l00355}00355         \textcolor{comment}{// The result container will always be, at most, the node count of g. }}
\DoxyCodeLine{\Hypertarget{a00011_source_l00356}00356         \textcolor{comment}{// We can preallocate this memory so we do not have to resize during the loop below.}}
\DoxyCodeLine{\Hypertarget{a00011_source_l00357}00357         std::vector<HF::SpatialStructures::EdgeSet> result(nodes.size());}
\DoxyCodeLine{\Hypertarget{a00011_source_l00358}00358         \textcolor{keyword}{auto} it\_result = result.begin();}
\DoxyCodeLine{\Hypertarget{a00011_source_l00359}00359 }
\DoxyCodeLine{\Hypertarget{a00011_source_l00360}00360         \textcolor{keywordflow}{for} (\mbox{\hyperlink{a02071}{Node}} parent\_node : nodes) \{}
\DoxyCodeLine{\Hypertarget{a00011_source_l00361}00361             \textcolor{comment}{// Get subgraph via parent\_node}}
\DoxyCodeLine{\Hypertarget{a00011_source_l00362}00362             \mbox{\hyperlink{a00465_a01543}{HF::SpatialStructures::Subgraph}} sg = g.\mbox{\hyperlink{a01551_a89250c619a726fd0adbd71778d166887}{GetSubgraph}}(parent\_node);}
\DoxyCodeLine{\Hypertarget{a00011_source_l00363}00363 }
\DoxyCodeLine{\Hypertarget{a00011_source_l00364}00364             \textcolor{comment}{// Call CalculateStepType using the subgraph}}
\DoxyCodeLine{\Hypertarget{a00011_source_l00365}00365             \mbox{\hyperlink{a01535}{HF::SpatialStructures::EdgeSet}} step\_types = \mbox{\hyperlink{a00463_a176c58b25fb5cb545d17128d4535f921}{CalculateStepType}}(sg, rt);}
\DoxyCodeLine{\Hypertarget{a00011_source_l00366}00366 }
\DoxyCodeLine{\Hypertarget{a00011_source_l00367}00367             *(it\_result++) = step\_types;}
\DoxyCodeLine{\Hypertarget{a00011_source_l00368}00368         \}}
\DoxyCodeLine{\Hypertarget{a00011_source_l00369}00369         \textcolor{keywordflow}{return} result;}
\DoxyCodeLine{\Hypertarget{a00011_source_l00370}00370     \}}
\DoxyCodeLine{\Hypertarget{a00011_source_l00371}00371 }
\DoxyCodeLine{\Hypertarget{a00011_source_l00372}\mbox{\hyperlink{a00463_a0251caf5a32eb2c1f9d846d88eb7fe22}{00372}}     \textcolor{keywordtype}{void} \mbox{\hyperlink{a00463_a0251caf5a32eb2c1f9d846d88eb7fe22}{CalculateAndStoreStepType}}(\mbox{\hyperlink{a01551}{HF::SpatialStructures::Graph}}\& g, \mbox{\hyperlink{a01419}{HF::RayTracer::MultiRT}}\& rt) \{}
\DoxyCodeLine{\Hypertarget{a00011_source_l00373}00373         \textcolor{comment}{// calculates and stores step types of all edges and stores it in the graph}}
\DoxyCodeLine{\Hypertarget{a00011_source_l00374}00374 }
\DoxyCodeLine{\Hypertarget{a00011_source_l00375}00375         \textcolor{comment}{// Compression needed before adding edges of alternate cost}}
\DoxyCodeLine{\Hypertarget{a00011_source_l00376}00376         g.\mbox{\hyperlink{a01551_a41cece77d0eee98df39ecc6d3a366ec8}{Compress}}();}
\DoxyCodeLine{\Hypertarget{a00011_source_l00377}00377 }
\DoxyCodeLine{\Hypertarget{a00011_source_l00378}00378         \textcolor{comment}{// Get all edges with weights corresponding to step type}}
\DoxyCodeLine{\Hypertarget{a00011_source_l00379}00379         \textcolor{keyword}{auto} result = \mbox{\hyperlink{a00463_a176c58b25fb5cb545d17128d4535f921}{HF::GraphGenerator::CalculateStepType}}(g, rt);}
\DoxyCodeLine{\Hypertarget{a00011_source_l00380}00380 }
\DoxyCodeLine{\Hypertarget{a00011_source_l00381}00381         \textcolor{comment}{// Add edges to the graph}}
\DoxyCodeLine{\Hypertarget{a00011_source_l00382}00382         g.\mbox{\hyperlink{a01551_a6f04c5320d4bf88120f8c5e31b0fb02a}{AddEdges}}(result, \textcolor{stringliteral}{"{}step\_type"{}});}
\DoxyCodeLine{\Hypertarget{a00011_source_l00383}00383     \}}
\DoxyCodeLine{\Hypertarget{a00011_source_l00384}00384 }
\DoxyCodeLine{\Hypertarget{a00011_source_l00385}\mbox{\hyperlink{a00463_a260a25e02193ce904849ee090daefa2e}{00385}}     \mbox{\hyperlink{a00465_af0378d900074d484ba791d4317e5935e}{HF::SpatialStructures::STEP}} \mbox{\hyperlink{a00463_a260a25e02193ce904849ee090daefa2e}{CheckConnection}}(}
\DoxyCodeLine{\Hypertarget{a00011_source_l00386}00386         \textcolor{keyword}{const} \mbox{\hyperlink{a00463_a8f7754dd4958185062ba8e0bc28d6579}{real3}}\& parent,}
\DoxyCodeLine{\Hypertarget{a00011_source_l00387}00387         \textcolor{keyword}{const} \mbox{\hyperlink{a00463_a8f7754dd4958185062ba8e0bc28d6579}{real3}}\& child,}
\DoxyCodeLine{\Hypertarget{a00011_source_l00388}00388         \mbox{\hyperlink{a01419}{RayTracer}}\& rt)}
\DoxyCodeLine{\Hypertarget{a00011_source_l00389}00389     \{}
\DoxyCodeLine{\Hypertarget{a00011_source_l00390}00390         \textcolor{comment}{// Default graphh generator ground offset}}
\DoxyCodeLine{\Hypertarget{a00011_source_l00391}00391         \textcolor{keyword}{const} \textcolor{keyword}{auto} GROUND\_OFFSET = 0.01;}
\DoxyCodeLine{\Hypertarget{a00011_source_l00392}00392 }
\DoxyCodeLine{\Hypertarget{a00011_source_l00393}00393         \textcolor{comment}{// Create a copy of parent and child that can be modified}}
\DoxyCodeLine{\Hypertarget{a00011_source_l00394}00394         \textcolor{keyword}{auto} node1 = parent;}
\DoxyCodeLine{\Hypertarget{a00011_source_l00395}00395         \textcolor{keyword}{auto} node2 = child;}
\DoxyCodeLine{\Hypertarget{a00011_source_l00396}00396 }
\DoxyCodeLine{\Hypertarget{a00011_source_l00397}00397         \textcolor{comment}{// Offset them from the ground slightly}}
\DoxyCodeLine{\Hypertarget{a00011_source_l00398}00398         node1[2] += GROUND\_OFFSET;}
\DoxyCodeLine{\Hypertarget{a00011_source_l00399}00399         node2[2] += GROUND\_OFFSET;}
\DoxyCodeLine{\Hypertarget{a00011_source_l00400}00400 }
\DoxyCodeLine{\Hypertarget{a00011_source_l00401}00401         \textcolor{keywordflow}{if} (!\mbox{\hyperlink{a00463_ace66c1b60785c32433402f012019ab81}{OcclusionCheck}}(node1, node2, rt)) \{}
\DoxyCodeLine{\Hypertarget{a00011_source_l00402}00402             \textcolor{comment}{// Case for when there is direct line of sight between nodes.}}
\DoxyCodeLine{\Hypertarget{a00011_source_l00403}00403             \textcolor{comment}{// Since the edge is already in the graph, we do not need to check whether}}
\DoxyCodeLine{\Hypertarget{a00011_source_l00404}00404             \textcolor{comment}{// they're on the same plane or if the slope between them is valid.}}
\DoxyCodeLine{\Hypertarget{a00011_source_l00405}00405             \textcolor{keywordflow}{return} STEP::NONE;}
\DoxyCodeLine{\Hypertarget{a00011_source_l00406}00406         \}}
\DoxyCodeLine{\Hypertarget{a00011_source_l00407}00407         \textcolor{comment}{// Otherwise check for step based connections.}}
\DoxyCodeLine{\Hypertarget{a00011_source_l00408}00408         \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{\Hypertarget{a00011_source_l00409}00409             \textcolor{comment}{// Since these edges were already verified in the graph generator,}}
\DoxyCodeLine{\Hypertarget{a00011_source_l00410}00410             \textcolor{comment}{// we do not need to check line of sight changes using offsets.}}
\DoxyCodeLine{\Hypertarget{a00011_source_l00411}00411             STEP s = STEP::NONE;}
\DoxyCodeLine{\Hypertarget{a00011_source_l00412}00412 }
\DoxyCodeLine{\Hypertarget{a00011_source_l00413}00413             \textcolor{comment}{// If parent is higher than child, then we have a down step}}
\DoxyCodeLine{\Hypertarget{a00011_source_l00414}00414             \textcolor{keywordflow}{if} (parent[2] > child[2]) \{}
\DoxyCodeLine{\Hypertarget{a00011_source_l00415}00415                 s = STEP::DOWN;}
\DoxyCodeLine{\Hypertarget{a00011_source_l00416}00416             \}}
\DoxyCodeLine{\Hypertarget{a00011_source_l00417}00417             \textcolor{comment}{// If parent is lower than child, then we have an up step.}}
\DoxyCodeLine{\Hypertarget{a00011_source_l00418}00418             \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (parent[2] < child[2]) \{}
\DoxyCodeLine{\Hypertarget{a00011_source_l00419}00419                 s = STEP::UP;}
\DoxyCodeLine{\Hypertarget{a00011_source_l00420}00420             \}}
\DoxyCodeLine{\Hypertarget{a00011_source_l00421}00421             \textcolor{comment}{// If parent is on an equal plane with the child, then we step over an obstacle.}}
\DoxyCodeLine{\Hypertarget{a00011_source_l00422}00422             \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (parent[2] == child[2]) \{}
\DoxyCodeLine{\Hypertarget{a00011_source_l00423}00423                 s = STEP::OVER;}
\DoxyCodeLine{\Hypertarget{a00011_source_l00424}00424             \}}
\DoxyCodeLine{\Hypertarget{a00011_source_l00425}00425             \textcolor{keywordflow}{return} s;}
\DoxyCodeLine{\Hypertarget{a00011_source_l00426}00426         \}}
\DoxyCodeLine{\Hypertarget{a00011_source_l00427}00427 }
\DoxyCodeLine{\Hypertarget{a00011_source_l00428}00428     \}}
\DoxyCodeLine{\Hypertarget{a00011_source_l00429}00429 }
\DoxyCodeLine{\Hypertarget{a00011_source_l00430}\mbox{\hyperlink{a00463_aeab1db37b5aa614235f109d5dd9711a9}{00430}}     \mbox{\hyperlink{a00465_af0378d900074d484ba791d4317e5935e}{HF::SpatialStructures::STEP}} \mbox{\hyperlink{a00463_a260a25e02193ce904849ee090daefa2e}{CheckConnection}}(}
\DoxyCodeLine{\Hypertarget{a00011_source_l00431}00431         \textcolor{keyword}{const} \mbox{\hyperlink{a00463_a8f7754dd4958185062ba8e0bc28d6579}{real3}}\& parent,}
\DoxyCodeLine{\Hypertarget{a00011_source_l00432}00432         \textcolor{keyword}{const} \mbox{\hyperlink{a00463_a8f7754dd4958185062ba8e0bc28d6579}{real3}}\& child,}
\DoxyCodeLine{\Hypertarget{a00011_source_l00433}00433         \mbox{\hyperlink{a01419}{RayTracer}}\& rt,}
\DoxyCodeLine{\Hypertarget{a00011_source_l00434}00434         \textcolor{keyword}{const} \mbox{\hyperlink{a00463_a01303}{GraphParams}}\& params)}
\DoxyCodeLine{\Hypertarget{a00011_source_l00435}00435     \{}
\DoxyCodeLine{\Hypertarget{a00011_source_l00436}00436         \textcolor{comment}{// Get groundoffset from graph parameters}}
\DoxyCodeLine{\Hypertarget{a00011_source_l00437}00437         \textcolor{keyword}{const} \textcolor{keyword}{auto} GROUND\_OFFSET = params.\mbox{\hyperlink{a00463_af7a57e8e6b17f86ac29a8df2685e56c1}{precision}}.\mbox{\hyperlink{a00463_a4fa4f096863296469711e52da4b36b9c}{ground\_offset}};}
\DoxyCodeLine{\Hypertarget{a00011_source_l00438}00438 }
\DoxyCodeLine{\Hypertarget{a00011_source_l00439}00439         \textcolor{comment}{// Create a copy of parent and child that can be modified}}
\DoxyCodeLine{\Hypertarget{a00011_source_l00440}00440         \textcolor{keyword}{auto} node1 = parent;}
\DoxyCodeLine{\Hypertarget{a00011_source_l00441}00441         \textcolor{keyword}{auto} node2 = child;}
\DoxyCodeLine{\Hypertarget{a00011_source_l00442}00442 }
\DoxyCodeLine{\Hypertarget{a00011_source_l00443}00443         \textcolor{comment}{// Offset them from the ground slightly}}
\DoxyCodeLine{\Hypertarget{a00011_source_l00444}00444         node1[2] += GROUND\_OFFSET;}
\DoxyCodeLine{\Hypertarget{a00011_source_l00445}00445         node2[2] += GROUND\_OFFSET;}
\DoxyCodeLine{\Hypertarget{a00011_source_l00446}00446 }
\DoxyCodeLine{\Hypertarget{a00011_source_l00447}00447         \textcolor{comment}{// See if there's a direct line of sight between parent and child}}
\DoxyCodeLine{\Hypertarget{a00011_source_l00448}00448         \textcolor{keywordflow}{if} (!\mbox{\hyperlink{a00463_ace66c1b60785c32433402f012019ab81}{OcclusionCheck}}(node1, node2, rt)) \{}
\DoxyCodeLine{\Hypertarget{a00011_source_l00449}00449             \textcolor{comment}{// If there is a direct line of sight, and they're on the same plane}}
\DoxyCodeLine{\Hypertarget{a00011_source_l00450}00450             \textcolor{comment}{// then there is no step.}}
\DoxyCodeLine{\Hypertarget{a00011_source_l00451}00451             \textcolor{keywordflow}{if} (abs(node1[2] -\/ node2[2]) < GROUND\_OFFSET) \textcolor{keywordflow}{return} STEP::NONE;}
\DoxyCodeLine{\Hypertarget{a00011_source_l00452}00452 }
\DoxyCodeLine{\Hypertarget{a00011_source_l00453}00453             \textcolor{comment}{// If they are not on the same plane, it means this is a slope. Check if the slope is within the threshold.         }}
\DoxyCodeLine{\Hypertarget{a00011_source_l00454}00454             \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (\mbox{\hyperlink{a00463_a9daa85cb56a1b18d44f46aa9c420afde}{CheckSlope}}(parent, child, params)) \textcolor{keywordflow}{return} STEP::NONE;}
\DoxyCodeLine{\Hypertarget{a00011_source_l00455}00455 }
\DoxyCodeLine{\Hypertarget{a00011_source_l00456}00456             \textcolor{keywordflow}{return} STEP::NOT\_CONNECTED;}
\DoxyCodeLine{\Hypertarget{a00011_source_l00457}00457         \}}
\DoxyCodeLine{\Hypertarget{a00011_source_l00458}00458 }
\DoxyCodeLine{\Hypertarget{a00011_source_l00459}00459         \textcolor{comment}{// Otherwise check for a step based connectiom}}
\DoxyCodeLine{\Hypertarget{a00011_source_l00460}00460         \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{\Hypertarget{a00011_source_l00461}00461             STEP s = STEP::NONE;}
\DoxyCodeLine{\Hypertarget{a00011_source_l00462}00462             \textcolor{comment}{// If parent is higher than child, the check is to go downstairs}}
\DoxyCodeLine{\Hypertarget{a00011_source_l00463}00463             \textcolor{comment}{// Since the child is lower, raise the child height by the downstep limit}}
\DoxyCodeLine{\Hypertarget{a00011_source_l00464}00464             \textcolor{comment}{// to be checked for a connection}}
\DoxyCodeLine{\Hypertarget{a00011_source_l00465}00465             \textcolor{keywordflow}{if} (parent[2] > child[2]) }
\DoxyCodeLine{\Hypertarget{a00011_source_l00466}00466             \{}
\DoxyCodeLine{\Hypertarget{a00011_source_l00467}00467                 node1 = child;}
\DoxyCodeLine{\Hypertarget{a00011_source_l00468}00468                 node2 = parent;}
\DoxyCodeLine{\Hypertarget{a00011_source_l00469}00469                 node1[2] = node1[2] + params.\mbox{\hyperlink{a00463_add2b6fa6bf77a8c4626a1e6d0559970f}{down\_step}};}
\DoxyCodeLine{\Hypertarget{a00011_source_l00470}00470                 node2[2] = node2[2] + GROUND\_OFFSET;}
\DoxyCodeLine{\Hypertarget{a00011_source_l00471}00471                 s = STEP::DOWN;}
\DoxyCodeLine{\Hypertarget{a00011_source_l00472}00472             \}}
\DoxyCodeLine{\Hypertarget{a00011_source_l00473}00473 }
\DoxyCodeLine{\Hypertarget{a00011_source_l00474}00474             \textcolor{comment}{// If parent is lower than child, the check is to go upstairs}}
\DoxyCodeLine{\Hypertarget{a00011_source_l00475}00475             \textcolor{comment}{// Since the child is lower, raise the child height by the upstep limit}}
\DoxyCodeLine{\Hypertarget{a00011_source_l00476}00476             \textcolor{comment}{// to be checked for a connection}}
\DoxyCodeLine{\Hypertarget{a00011_source_l00477}00477             \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (node1[2] < node2[2]) }
\DoxyCodeLine{\Hypertarget{a00011_source_l00478}00478             \{}
\DoxyCodeLine{\Hypertarget{a00011_source_l00479}00479                 node1 = parent;}
\DoxyCodeLine{\Hypertarget{a00011_source_l00480}00480                 node2 = child;}
\DoxyCodeLine{\Hypertarget{a00011_source_l00481}00481                 node1[2] = node1[2] + params.\mbox{\hyperlink{a00463_a0b8afc5f531e3286ce2434b1bc2b1f50}{up\_step}};}
\DoxyCodeLine{\Hypertarget{a00011_source_l00482}00482                 node2[2] = node2[2] + GROUND\_OFFSET;}
\DoxyCodeLine{\Hypertarget{a00011_source_l00483}00483                 s = STEP::UP;}
\DoxyCodeLine{\Hypertarget{a00011_source_l00484}00484             \}}
\DoxyCodeLine{\Hypertarget{a00011_source_l00485}00485 }
\DoxyCodeLine{\Hypertarget{a00011_source_l00486}00486             \textcolor{comment}{// If they're on an equal plane then offset by upstep to see}}
\DoxyCodeLine{\Hypertarget{a00011_source_l00487}00487             \textcolor{comment}{// if the obstacle can be stepped over.}}
\DoxyCodeLine{\Hypertarget{a00011_source_l00488}00488             \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (node1[2] == node2[2]) }
\DoxyCodeLine{\Hypertarget{a00011_source_l00489}00489             \{}
\DoxyCodeLine{\Hypertarget{a00011_source_l00490}00490                 node1 = parent;}
\DoxyCodeLine{\Hypertarget{a00011_source_l00491}00491                 node2 = child;}
\DoxyCodeLine{\Hypertarget{a00011_source_l00492}00492                 node1[2] = node1[2] + params.\mbox{\hyperlink{a00463_a0b8afc5f531e3286ce2434b1bc2b1f50}{up\_step}};}
\DoxyCodeLine{\Hypertarget{a00011_source_l00493}00493                 node2[2] = node2[2] + GROUND\_OFFSET;}
\DoxyCodeLine{\Hypertarget{a00011_source_l00494}00494                 s = STEP::OVER;}
\DoxyCodeLine{\Hypertarget{a00011_source_l00495}00495             \}}
\DoxyCodeLine{\Hypertarget{a00011_source_l00496}00496 }
\DoxyCodeLine{\Hypertarget{a00011_source_l00497}00497             \textcolor{comment}{// If there is a line of sight then the nodes are connected}}
\DoxyCodeLine{\Hypertarget{a00011_source_l00498}00498             \textcolor{comment}{// with the step type we calculated}}
\DoxyCodeLine{\Hypertarget{a00011_source_l00499}00499             \textcolor{keywordflow}{if} (!\mbox{\hyperlink{a00463_ace66c1b60785c32433402f012019ab81}{OcclusionCheck}}(node1, node2, rt))}
\DoxyCodeLine{\Hypertarget{a00011_source_l00500}00500                 \textcolor{keywordflow}{return} s;}
\DoxyCodeLine{\Hypertarget{a00011_source_l00501}00501         \}}
\DoxyCodeLine{\Hypertarget{a00011_source_l00502}00502 }
\DoxyCodeLine{\Hypertarget{a00011_source_l00503}00503         \textcolor{comment}{// If not, then there is no connection between these}}
\DoxyCodeLine{\Hypertarget{a00011_source_l00504}00504         \textcolor{comment}{// nodes.}}
\DoxyCodeLine{\Hypertarget{a00011_source_l00505}00505         \textcolor{keywordflow}{return} STEP::NOT\_CONNECTED;}
\DoxyCodeLine{\Hypertarget{a00011_source_l00506}00506     \}}
\DoxyCodeLine{\Hypertarget{a00011_source_l00507}00507 }
\DoxyCodeLine{\Hypertarget{a00011_source_l00508}\mbox{\hyperlink{a00463_a5d2ad6de2131b1a90a80f901ac8dd185}{00508}}     \textcolor{keywordtype}{bool} \mbox{\hyperlink{a00463_a5d2ad6de2131b1a90a80f901ac8dd185}{CompareCheckConnections}}(\mbox{\hyperlink{a01551}{HF::SpatialStructures::Graph}}\& g, \mbox{\hyperlink{a01419}{RayTracer}}\& rt,}
\DoxyCodeLine{\Hypertarget{a00011_source_l00509}00509         \textcolor{keyword}{const} \mbox{\hyperlink{a00463_a01303}{GraphParams}}\& params, std::vector < HF::SpatialStructures::EdgeSet> to\_compare)}
\DoxyCodeLine{\Hypertarget{a00011_source_l00510}00510     \{}
\DoxyCodeLine{\Hypertarget{a00011_source_l00511}00511         \textcolor{keyword}{const} \textcolor{keyword}{auto} graph\_nodes = g.\mbox{\hyperlink{a01551_aa70347b8a33b57c6f0a72d6eca4248d7}{Nodes}}();}
\DoxyCodeLine{\Hypertarget{a00011_source_l00512}00512         \textcolor{keywordflow}{for} (\mbox{\hyperlink{a02071}{Node}} node : graph\_nodes) \{}
\DoxyCodeLine{\Hypertarget{a00011_source_l00513}00513             \textcolor{keywordtype}{int} parent\_id = node.id;}
\DoxyCodeLine{\Hypertarget{a00011_source_l00514}00514             std::vector<HF::SpatialStructures::IntEdge> outgoing\_edges = to\_compare[parent\_id].children;}
\DoxyCodeLine{\Hypertarget{a00011_source_l00515}00515             \textcolor{keywordflow}{for} (\mbox{\hyperlink{a01531}{HF::SpatialStructures::IntEdge}} edge : outgoing\_edges) \{}
\DoxyCodeLine{\Hypertarget{a00011_source_l00516}00516                 \textcolor{keywordtype}{int} child\_id = edge.child;}
\DoxyCodeLine{\Hypertarget{a00011_source_l00517}00517                 \textcolor{keywordtype}{float} step\_type = edge.weight;}
\DoxyCodeLine{\Hypertarget{a00011_source_l00518}00518                 \mbox{\hyperlink{a02071}{Node}} child = g.\mbox{\hyperlink{a01551_a794c342603cefb342fdc698ba539b25f}{NodeFromID}}(child\_id);}
\DoxyCodeLine{\Hypertarget{a00011_source_l00519}00519 }
\DoxyCodeLine{\Hypertarget{a00011_source_l00520}00520                 \textcolor{comment}{//Type Casting}}
\DoxyCodeLine{\Hypertarget{a00011_source_l00521}00521                 \mbox{\hyperlink{a00463_a6d9d3b43eebc7f05a36e6264eb08bb5a}{real\_t}} parent\_x = \mbox{\hyperlink{a00463_a73b53db067a504d36e9481dfe3326b60}{CastToReal}}(node.x);}
\DoxyCodeLine{\Hypertarget{a00011_source_l00522}00522                 \mbox{\hyperlink{a00463_a6d9d3b43eebc7f05a36e6264eb08bb5a}{real\_t}} parent\_y = \mbox{\hyperlink{a00463_a73b53db067a504d36e9481dfe3326b60}{CastToReal}}(node.y);}
\DoxyCodeLine{\Hypertarget{a00011_source_l00523}00523                 \mbox{\hyperlink{a00463_a6d9d3b43eebc7f05a36e6264eb08bb5a}{real\_t}} parent\_z = \mbox{\hyperlink{a00463_a73b53db067a504d36e9481dfe3326b60}{CastToReal}}(node.z);}
\DoxyCodeLine{\Hypertarget{a00011_source_l00524}00524 }
\DoxyCodeLine{\Hypertarget{a00011_source_l00525}00525                 \mbox{\hyperlink{a00463_a6d9d3b43eebc7f05a36e6264eb08bb5a}{real\_t}} child\_x = \mbox{\hyperlink{a00463_a73b53db067a504d36e9481dfe3326b60}{CastToReal}}(child.\mbox{\hyperlink{a02071_a78dfebaa44da09b03d7ca15445c8d222}{x}});}
\DoxyCodeLine{\Hypertarget{a00011_source_l00526}00526                 \mbox{\hyperlink{a00463_a6d9d3b43eebc7f05a36e6264eb08bb5a}{real\_t}} child\_y = \mbox{\hyperlink{a00463_a73b53db067a504d36e9481dfe3326b60}{CastToReal}}(child.\mbox{\hyperlink{a02071_a41981fb2cc6dc0edb787f921188702b0}{y}});}
\DoxyCodeLine{\Hypertarget{a00011_source_l00527}00527                 \mbox{\hyperlink{a00463_a6d9d3b43eebc7f05a36e6264eb08bb5a}{real\_t}} child\_z = \mbox{\hyperlink{a00463_a73b53db067a504d36e9481dfe3326b60}{CastToReal}}(child.\mbox{\hyperlink{a02071_a495b47689917e0395ce96ee01d3f5ed3}{z}});}
\DoxyCodeLine{\Hypertarget{a00011_source_l00528}00528 }
\DoxyCodeLine{\Hypertarget{a00011_source_l00529}00529                 std::vector<real\_t> parent\_loc = \{ parent\_x, parent\_y, parent\_z \};}
\DoxyCodeLine{\Hypertarget{a00011_source_l00530}00530                 std::vector<real\_t> child\_loc = \{ child\_x, child\_y, child\_z \};}
\DoxyCodeLine{\Hypertarget{a00011_source_l00531}00531 }
\DoxyCodeLine{\Hypertarget{a00011_source_l00532}00532                 \mbox{\hyperlink{a00463_a8f7754dd4958185062ba8e0bc28d6579}{real3}} parent\_cast = \mbox{\hyperlink{a00463_a58892abe1152c28d26d3ca749c99ea4d}{CastToReal3}}(parent\_loc);}
\DoxyCodeLine{\Hypertarget{a00011_source_l00533}00533                 \mbox{\hyperlink{a00463_a8f7754dd4958185062ba8e0bc28d6579}{real3}} child\_cast = \mbox{\hyperlink{a00463_a58892abe1152c28d26d3ca749c99ea4d}{CastToReal3}}(child\_loc);}
\DoxyCodeLine{\Hypertarget{a00011_source_l00534}00534 }
\DoxyCodeLine{\Hypertarget{a00011_source_l00535}00535                 \textcolor{keywordtype}{float} expected\_step\_type = \textcolor{keyword}{static\_cast<}\textcolor{keywordtype}{float}\textcolor{keyword}{>}(\mbox{\hyperlink{a00463_a260a25e02193ce904849ee090daefa2e}{CheckConnection}}(parent\_cast, child\_cast,}
\DoxyCodeLine{\Hypertarget{a00011_source_l00536}00536                     rt, params));}
\DoxyCodeLine{\Hypertarget{a00011_source_l00537}00537                 \textcolor{keywordflow}{if} (expected\_step\_type != 0 \&\& expected\_step\_type != step\_type) \{}
\DoxyCodeLine{\Hypertarget{a00011_source_l00538}00538                     \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{a00011_source_l00539}00539                 \}}
\DoxyCodeLine{\Hypertarget{a00011_source_l00540}00540             \}}
\DoxyCodeLine{\Hypertarget{a00011_source_l00541}00541         \}}
\DoxyCodeLine{\Hypertarget{a00011_source_l00542}00542         \textcolor{keywordflow}{return} \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{a00011_source_l00543}00543     \}}
\DoxyCodeLine{\Hypertarget{a00011_source_l00544}\mbox{\hyperlink{a00463_a41e03f9bab54e4e0d1314c6a4bdf2ec1}{00544}}     std::vector<real3> \mbox{\hyperlink{a00463_a41e03f9bab54e4e0d1314c6a4bdf2ec1}{GeneratePotentialChildren}}(}
\DoxyCodeLine{\Hypertarget{a00011_source_l00545}00545         \textcolor{keyword}{const} \mbox{\hyperlink{a00463_a8f7754dd4958185062ba8e0bc28d6579}{real3}}\& parent,}
\DoxyCodeLine{\Hypertarget{a00011_source_l00546}00546         \textcolor{keyword}{const} std::vector<pair>\& directions,}
\DoxyCodeLine{\Hypertarget{a00011_source_l00547}00547         \textcolor{keyword}{const} \mbox{\hyperlink{a00463_a8f7754dd4958185062ba8e0bc28d6579}{real3}}\& spacing,}
\DoxyCodeLine{\Hypertarget{a00011_source_l00548}00548         \textcolor{keyword}{const} \mbox{\hyperlink{a00463_a01303}{GraphParams}}\& GP) }
\DoxyCodeLine{\Hypertarget{a00011_source_l00549}00549     \{}
\DoxyCodeLine{\Hypertarget{a00011_source_l00550}00550         \textcolor{comment}{// Create a vector of out\_children to hold results}}
\DoxyCodeLine{\Hypertarget{a00011_source_l00551}00551         vector<real3> out\_children(directions.size());}
\DoxyCodeLine{\Hypertarget{a00011_source_l00552}00552 }
\DoxyCodeLine{\Hypertarget{a00011_source_l00553}00553         \textcolor{comment}{// Iterate through the set of all directions, then offset children in each direction}}
\DoxyCodeLine{\Hypertarget{a00011_source_l00554}00554         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i = 0; i < directions.size(); i++) \{}
\DoxyCodeLine{\Hypertarget{a00011_source_l00555}00555             \textcolor{comment}{// Get the direction at this index}}
\DoxyCodeLine{\Hypertarget{a00011_source_l00556}00556             \textcolor{keyword}{const} \textcolor{keyword}{auto}\& dir = directions[i];}
\DoxyCodeLine{\Hypertarget{a00011_source_l00557}00557 }
\DoxyCodeLine{\Hypertarget{a00011_source_l00558}00558             \textcolor{comment}{// Extract the x and y directions}}
\DoxyCodeLine{\Hypertarget{a00011_source_l00559}00559             \mbox{\hyperlink{a00463_a6d9d3b43eebc7f05a36e6264eb08bb5a}{real\_t}} x\_offset = dir.first;}
\DoxyCodeLine{\Hypertarget{a00011_source_l00560}00560             \mbox{\hyperlink{a00463_a6d9d3b43eebc7f05a36e6264eb08bb5a}{real\_t}} y\_offset = dir.second;}
\DoxyCodeLine{\Hypertarget{a00011_source_l00561}00561 }
\DoxyCodeLine{\Hypertarget{a00011_source_l00562}00562             \textcolor{comment}{// Add the user-\/defined spacing to the x and y components of the parent.}}
\DoxyCodeLine{\Hypertarget{a00011_source_l00563}00563             \textcolor{comment}{// Then round the result.}}
\DoxyCodeLine{\Hypertarget{a00011_source_l00564}00564             \textcolor{keyword}{const} \mbox{\hyperlink{a00463_a6d9d3b43eebc7f05a36e6264eb08bb5a}{real\_t}} x = roundhf\_tmp<real\_t>(std::fma(x\_offset,spacing[0], parent[0]), GP.\mbox{\hyperlink{a00463_af7a57e8e6b17f86ac29a8df2685e56c1}{precision}}.\mbox{\hyperlink{a00463_ac982230f7d151df6018c19d712cd3436}{node\_spacing}});}
\DoxyCodeLine{\Hypertarget{a00011_source_l00565}00565             \textcolor{keyword}{const} \mbox{\hyperlink{a00463_a6d9d3b43eebc7f05a36e6264eb08bb5a}{real\_t}} y = roundhf\_tmp<real\_t>(std::fma(y\_offset,spacing[1], parent[1]), GP.\mbox{\hyperlink{a00463_af7a57e8e6b17f86ac29a8df2685e56c1}{precision}}.\mbox{\hyperlink{a00463_ac982230f7d151df6018c19d712cd3436}{node\_spacing}});}
\DoxyCodeLine{\Hypertarget{a00011_source_l00566}00566             \textcolor{comment}{// Round the z value to a lower precision assuming it helps embree}}
\DoxyCodeLine{\Hypertarget{a00011_source_l00567}00567             \textcolor{keyword}{const} \mbox{\hyperlink{a00463_a6d9d3b43eebc7f05a36e6264eb08bb5a}{real\_t}} z = roundhf\_tmp<real\_t>(parent[2] + spacing[2], GP.\mbox{\hyperlink{a00463_af7a57e8e6b17f86ac29a8df2685e56c1}{precision}}.\mbox{\hyperlink{a00463_a6ec86cb69c1cc0e0dc8ea229310939b6}{node\_z}});}
\DoxyCodeLine{\Hypertarget{a00011_source_l00568}00568 }
\DoxyCodeLine{\Hypertarget{a00011_source_l00569}00569             \textcolor{comment}{// Add these new values as a node in the out\_children list}}
\DoxyCodeLine{\Hypertarget{a00011_source_l00570}00570             out\_children[i] = \mbox{\hyperlink{a00463_a8f7754dd4958185062ba8e0bc28d6579}{real3}}\{ x, y, z \};}
\DoxyCodeLine{\Hypertarget{a00011_source_l00571}00571         \}}
\DoxyCodeLine{\Hypertarget{a00011_source_l00572}00572 }
\DoxyCodeLine{\Hypertarget{a00011_source_l00573}00573         \textcolor{keywordflow}{return} out\_children;}
\DoxyCodeLine{\Hypertarget{a00011_source_l00574}00574     \}}
\DoxyCodeLine{\Hypertarget{a00011_source_l00575}00575 \}}

\end{DoxyCode}
