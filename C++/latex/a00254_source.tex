\hypertarget{a00254_source}{}\doxysection{cost\+\_\+algorithms.\+cpp}
\label{a00254_source}\index{Cpp/spatialstructures/src/cost\_algorithms.cpp@{Cpp/spatialstructures/src/cost\_algorithms.cpp}}
\mbox{\hyperlink{a00254}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{\Hypertarget{a00254_source_l00001}00001 }
\DoxyCodeLine{\Hypertarget{a00254_source_l00008}00008 }
\DoxyCodeLine{\Hypertarget{a00254_source_l00009}\mbox{\hyperlink{a00254_a525335710b53cb064ca56b936120431e}{00009}} \textcolor{preprocessor}{\#define \_USE\_MATH\_DEFINES}}
\DoxyCodeLine{\Hypertarget{a00254_source_l00010}00010 \textcolor{preprocessor}{\#include <cmath>}}
\DoxyCodeLine{\Hypertarget{a00254_source_l00011}00011 \textcolor{preprocessor}{\#include <algorithm>}}
\DoxyCodeLine{\Hypertarget{a00254_source_l00012}00012 }
\DoxyCodeLine{\Hypertarget{a00254_source_l00013}00013 \textcolor{preprocessor}{\#include "{}\mbox{\hyperlink{a00257}{cost\_algorithms.h}}"{}}}
\DoxyCodeLine{\Hypertarget{a00254_source_l00014}00014 \textcolor{preprocessor}{\#include "{}\mbox{\hyperlink{a00269}{graph.h}}"{}}}
\DoxyCodeLine{\Hypertarget{a00254_source_l00015}00015 \textcolor{preprocessor}{\#include "{}\mbox{\hyperlink{a00251}{constants.h}}"{}}}
\DoxyCodeLine{\Hypertarget{a00254_source_l00016}00016 }
\DoxyCodeLine{\Hypertarget{a00254_source_l00017}00017 \textcolor{preprocessor}{\#include <iostream>}}
\DoxyCodeLine{\Hypertarget{a00254_source_l00018}00018 }
\DoxyCodeLine{\Hypertarget{a00254_source_l00019}00019 \textcolor{keyword}{using }\mbox{\hyperlink{a02071}{HF::SpatialStructures::Node}};}
\DoxyCodeLine{\Hypertarget{a00254_source_l00020}00020 \textcolor{keyword}{using }\mbox{\hyperlink{a01531}{HF::SpatialStructures::IntEdge}};}
\DoxyCodeLine{\Hypertarget{a00254_source_l00021}00021 \textcolor{keyword}{using }\mbox{\hyperlink{a01551}{HF::SpatialStructures::Graph}};}
\DoxyCodeLine{\Hypertarget{a00254_source_l00022}00022 \textcolor{keyword}{using }\mbox{\hyperlink{a00465_a01543}{HF::SpatialStructures::Subgraph}};}
\DoxyCodeLine{\Hypertarget{a00254_source_l00023}00023 \textcolor{keyword}{using }\mbox{\hyperlink{a01535}{HF::SpatialStructures::EdgeSet}};}
\DoxyCodeLine{\Hypertarget{a00254_source_l00024}00024 }
\DoxyCodeLine{\Hypertarget{a00254_source_l00025}\mbox{\hyperlink{a00475}{00025}} \textcolor{keyword}{namespace }\mbox{\hyperlink{a00475}{HF::SpatialStructures::CostAlgorithms}} \{}
\DoxyCodeLine{\Hypertarget{a00254_source_l00026}\mbox{\hyperlink{a00475_ae7b446fefe0b9994859f47b85de79039}{00026}}     \textcolor{keywordtype}{double} \mbox{\hyperlink{a00475_ae7b446fefe0b9994859f47b85de79039}{to\_radians}}(\textcolor{keywordtype}{double} degrees) \{}
\DoxyCodeLine{\Hypertarget{a00254_source_l00027}00027         \textcolor{keywordflow}{return} degrees * (M\_PI / 180);}
\DoxyCodeLine{\Hypertarget{a00254_source_l00028}00028     \}}
\DoxyCodeLine{\Hypertarget{a00254_source_l00029}00029 }
\DoxyCodeLine{\Hypertarget{a00254_source_l00030}\mbox{\hyperlink{a00475_adee2fb2573f4dbc2e5c7db153dff2694}{00030}}     \textcolor{keywordtype}{double} \mbox{\hyperlink{a00475_adee2fb2573f4dbc2e5c7db153dff2694}{to\_degrees}}(\textcolor{keywordtype}{double} radians) \{}
\DoxyCodeLine{\Hypertarget{a00254_source_l00031}00031         \textcolor{keywordflow}{return} radians * (180 / M\_PI);}
\DoxyCodeLine{\Hypertarget{a00254_source_l00032}00032     \}}
\DoxyCodeLine{\Hypertarget{a00254_source_l00033}00033 }
\DoxyCodeLine{\Hypertarget{a00254_source_l00034}\mbox{\hyperlink{a00475_ae06eb693d0d7858d7a863fae3a6eee2c}{00034}}     \textcolor{keywordtype}{double} \mbox{\hyperlink{a00475_ae06eb693d0d7858d7a863fae3a6eee2c}{CalculateSlope}}(\mbox{\hyperlink{a02071}{Node}}\& parent, \mbox{\hyperlink{a02071}{Node}}\& child)}
\DoxyCodeLine{\Hypertarget{a00254_source_l00035}00035     \{}
\DoxyCodeLine{\Hypertarget{a00254_source_l00036}00036         \textcolor{comment}{// Calculates the Slope between two nodes as an angle in degrees.}}
\DoxyCodeLine{\Hypertarget{a00254_source_l00037}00037         \textcolor{comment}{// This could be split into two functions later since the first commented part is simply rise/run}}
\DoxyCodeLine{\Hypertarget{a00254_source_l00038}00038         \textcolor{comment}{// The second part is a generic cosine angle between vectors }}
\DoxyCodeLine{\Hypertarget{a00254_source_l00039}00039 }
\DoxyCodeLine{\Hypertarget{a00254_source_l00040}00040         \textcolor{comment}{// Calculate slope with Rise over Run using atan2}}
\DoxyCodeLine{\Hypertarget{a00254_source_l00041}00041         \textcolor{comment}{/*}}
\DoxyCodeLine{\Hypertarget{a00254_source_l00042}00042 \textcolor{comment}{        double run = std::sqrt( std::pow(parent[0]-\/child[0],2) + std::pow(parent[1]-\/child[1],2) );}}
\DoxyCodeLine{\Hypertarget{a00254_source_l00043}00043 \textcolor{comment}{        double rise = parent[2] -\/ child[2];}}
\DoxyCodeLine{\Hypertarget{a00254_source_l00044}00044 \textcolor{comment}{        double slope = to\_degrees(std::atan2(rise, run));}}
\DoxyCodeLine{\Hypertarget{a00254_source_l00045}00045 \textcolor{comment}{        */}}
\DoxyCodeLine{\Hypertarget{a00254_source_l00046}00046 }
\DoxyCodeLine{\Hypertarget{a00254_source_l00047}00047         \textcolor{comment}{// Calculate slope with cosine of two vectors}}
\DoxyCodeLine{\Hypertarget{a00254_source_l00048}00048 }
\DoxyCodeLine{\Hypertarget{a00254_source_l00049}00049         \textcolor{comment}{// Get the vector between the points for the first vector}}
\DoxyCodeLine{\Hypertarget{a00254_source_l00050}00050         \textcolor{keywordtype}{double} n1 = child[0] -\/ parent[0];}
\DoxyCodeLine{\Hypertarget{a00254_source_l00051}00051         \textcolor{keywordtype}{double} n2 = child[1] -\/ parent[1];}
\DoxyCodeLine{\Hypertarget{a00254_source_l00052}00052         \textcolor{keywordtype}{double} n3 = child[2] -\/ parent[2];}
\DoxyCodeLine{\Hypertarget{a00254_source_l00053}00053 }
\DoxyCodeLine{\Hypertarget{a00254_source_l00054}00054         \textcolor{comment}{// Second vector is the z unit vector}}
\DoxyCodeLine{\Hypertarget{a00254_source_l00055}00055         \textcolor{keywordtype}{double} u1 = 0;}
\DoxyCodeLine{\Hypertarget{a00254_source_l00056}00056         \textcolor{keywordtype}{double} u2 = 0;}
\DoxyCodeLine{\Hypertarget{a00254_source_l00057}00057         \textcolor{keywordtype}{double} u3 = 1;}
\DoxyCodeLine{\Hypertarget{a00254_source_l00058}00058 }
\DoxyCodeLine{\Hypertarget{a00254_source_l00059}00059         \textcolor{comment}{// double numerator = std::abs((n1 * u1) + (n2 * u2) + (n3 * u3));}}
\DoxyCodeLine{\Hypertarget{a00254_source_l00060}00060         \textcolor{comment}{// Which reduces to:}}
\DoxyCodeLine{\Hypertarget{a00254_source_l00061}00061         \textcolor{keywordtype}{double} numerator = std::abs(n3);}
\DoxyCodeLine{\Hypertarget{a00254_source_l00062}00062 }
\DoxyCodeLine{\Hypertarget{a00254_source_l00063}00063         \textcolor{comment}{// Distance of first vector }}
\DoxyCodeLine{\Hypertarget{a00254_source_l00064}00064         \textcolor{keywordtype}{double} denom = std::sqrt(std::pow(n1, 2) + std::pow(n2, 2) + std::pow(n3, 2));}
\DoxyCodeLine{\Hypertarget{a00254_source_l00065}00065 }
\DoxyCodeLine{\Hypertarget{a00254_source_l00066}00066         \textcolor{comment}{// Distance of second vector }}
\DoxyCodeLine{\Hypertarget{a00254_source_l00067}00067         \textcolor{comment}{// double denom\_2 = std::abs(std::sqrt(std::pow(u1, 2) + std::pow(u2, 2) + std::pow(u3, 2)));}}
\DoxyCodeLine{\Hypertarget{a00254_source_l00068}00068         \textcolor{comment}{// Which reduces to:}}
\DoxyCodeLine{\Hypertarget{a00254_source_l00069}00069         \textcolor{comment}{//  double denom\_2 = std::sqrt(std::pow(u3, 2));}}
\DoxyCodeLine{\Hypertarget{a00254_source_l00070}00070         \textcolor{comment}{//  and then}}
\DoxyCodeLine{\Hypertarget{a00254_source_l00071}00071         \textcolor{comment}{//  double denom\_2 = u3;}}
\DoxyCodeLine{\Hypertarget{a00254_source_l00072}00072         \textcolor{comment}{// Which is 1}}
\DoxyCodeLine{\Hypertarget{a00254_source_l00073}00073 }
\DoxyCodeLine{\Hypertarget{a00254_source_l00074}00074         \textcolor{keywordtype}{double} res = std::asin(numerator/denom);}
\DoxyCodeLine{\Hypertarget{a00254_source_l00075}00075 }
\DoxyCodeLine{\Hypertarget{a00254_source_l00076}00076         \textcolor{keywordtype}{int} direc;}
\DoxyCodeLine{\Hypertarget{a00254_source_l00077}00077         \textcolor{keywordflow}{if} (child[2] > parent[2])\{}
\DoxyCodeLine{\Hypertarget{a00254_source_l00078}00078             direc = 1;}
\DoxyCodeLine{\Hypertarget{a00254_source_l00079}00079         \}}
\DoxyCodeLine{\Hypertarget{a00254_source_l00080}00080 }
\DoxyCodeLine{\Hypertarget{a00254_source_l00081}00081         \textcolor{keywordflow}{else}\{}
\DoxyCodeLine{\Hypertarget{a00254_source_l00082}00082             direc = -\/1;}
\DoxyCodeLine{\Hypertarget{a00254_source_l00083}00083         \}}
\DoxyCodeLine{\Hypertarget{a00254_source_l00084}00084 }
\DoxyCodeLine{\Hypertarget{a00254_source_l00085}00085         \textcolor{keywordtype}{double} slope = \mbox{\hyperlink{a00475_adee2fb2573f4dbc2e5c7db153dff2694}{to\_degrees}}(res) * direc;}
\DoxyCodeLine{\Hypertarget{a00254_source_l00086}00086 }
\DoxyCodeLine{\Hypertarget{a00254_source_l00087}00087         \textcolor{comment}{// This will catch nan, infinity, and negative infinity.}}
\DoxyCodeLine{\Hypertarget{a00254_source_l00088}00088         \textcolor{comment}{// All of these values would break the calculation.}}
\DoxyCodeLine{\Hypertarget{a00254_source_l00089}00089         \textcolor{keywordflow}{if} (!std::isfinite(slope))}
\DoxyCodeLine{\Hypertarget{a00254_source_l00090}00090             slope = 0;}
\DoxyCodeLine{\Hypertarget{a00254_source_l00091}00091 }
\DoxyCodeLine{\Hypertarget{a00254_source_l00092}00092         \textcolor{keywordflow}{return} slope;}
\DoxyCodeLine{\Hypertarget{a00254_source_l00093}00093         }
\DoxyCodeLine{\Hypertarget{a00254_source_l00094}00094     \}}
\DoxyCodeLine{\Hypertarget{a00254_source_l00095}00095 }
\DoxyCodeLine{\Hypertarget{a00254_source_l00096}\mbox{\hyperlink{a00475_ac51f2e76c00356f8a6145bee865cd922}{00096}}     \mbox{\hyperlink{a01535}{EdgeSet}} \mbox{\hyperlink{a00475_ac51f2e76c00356f8a6145bee865cd922}{CalculateEnergyExpenditure}}(\textcolor{keyword}{const} \mbox{\hyperlink{a00465_a01543}{Subgraph}}\& sg) \{}
\DoxyCodeLine{\Hypertarget{a00254_source_l00097}00097         \textcolor{comment}{// Energy expenditure data will be stored here and returned from this function.}}
\DoxyCodeLine{\Hypertarget{a00254_source_l00098}00098         std::vector<EdgeSet> edge\_set;}
\DoxyCodeLine{\Hypertarget{a00254_source_l00099}00099 }
\DoxyCodeLine{\Hypertarget{a00254_source_l00100}00100         \textcolor{comment}{// From Subgraph sg}}
\DoxyCodeLine{\Hypertarget{a00254_source_l00101}00101         \mbox{\hyperlink{a02071}{Node}} parent\_node = sg.\mbox{\hyperlink{a00465_a2f8de99f10387d075d7d69336e4d5dd7}{m\_parent}};}
\DoxyCodeLine{\Hypertarget{a00254_source_l00102}00102         std::vector<Edge> edge\_list = sg.\mbox{\hyperlink{a00465_ac1403ade5ddeb5410a523871f96e1e64}{m\_edges}};}
\DoxyCodeLine{\Hypertarget{a00254_source_l00103}00103 }
\DoxyCodeLine{\Hypertarget{a00254_source_l00104}00104         \textcolor{comment}{// We can preallocate this container to have edge\_list.size()}}
\DoxyCodeLine{\Hypertarget{a00254_source_l00105}00105         \textcolor{comment}{// blocks since we know exactly how many children make up the subgraph.}}
\DoxyCodeLine{\Hypertarget{a00254_source_l00106}00106         std::vector<IntEdge> children(edge\_list.size());}
\DoxyCodeLine{\Hypertarget{a00254_source_l00107}00107         \textcolor{keyword}{auto} it\_children = children.begin();}
\DoxyCodeLine{\Hypertarget{a00254_source_l00108}00108 }
\DoxyCodeLine{\Hypertarget{a00254_source_l00109}00109         \textcolor{keywordflow}{for} (\mbox{\hyperlink{a01527}{Edge}} link\_a : edge\_list) \{}
\DoxyCodeLine{\Hypertarget{a00254_source_l00110}00110             \textcolor{comment}{// Retrieve vector components of the vector formed by}}
\DoxyCodeLine{\Hypertarget{a00254_source_l00111}00111             \textcolor{comment}{// parent\_node and link\_a}}
\DoxyCodeLine{\Hypertarget{a00254_source_l00112}00112 }
\DoxyCodeLine{\Hypertarget{a00254_source_l00113}00113             \textcolor{keyword}{const} \textcolor{keyword}{auto} dir = parent\_node.\mbox{\hyperlink{a02071_ad3f7898ef3178eef0c3579869a7f5c67}{directionTo}}(link\_a.child);}
\DoxyCodeLine{\Hypertarget{a00254_source_l00114}00114             \textcolor{keyword}{const} \textcolor{keyword}{auto} magnitude = parent\_node.\mbox{\hyperlink{a02071_abbd66b566460f9557a373b5fbcc30bb1}{distanceTo}}(link\_a.child);}
\DoxyCodeLine{\Hypertarget{a00254_source_l00115}00115 }
\DoxyCodeLine{\Hypertarget{a00254_source_l00116}00116             \textcolor{comment}{//}}
\DoxyCodeLine{\Hypertarget{a00254_source_l00117}00117             \textcolor{comment}{//  Angle formula in R3 is:}}
\DoxyCodeLine{\Hypertarget{a00254_source_l00118}00118             \textcolor{comment}{//  acos(dot\_product(vector\_U, vector\_V) / magnitude(vector\_U) * magnitude(vector\_V));}}
\DoxyCodeLine{\Hypertarget{a00254_source_l00119}00119             \textcolor{comment}{//}}
\DoxyCodeLine{\Hypertarget{a00254_source_l00120}00120             \textcolor{comment}{//  vector\_V will be a unit vector i, j, or k for x, y, and z axes respectively.}}
\DoxyCodeLine{\Hypertarget{a00254_source_l00121}00121             \textcolor{comment}{//  Therefore, we simplify these angle formulas to:}}
\DoxyCodeLine{\Hypertarget{a00254_source_l00122}00122             \textcolor{comment}{//  acos(component\_value / magnitude(vector\_U))}}
\DoxyCodeLine{\Hypertarget{a00254_source_l00123}00123             \textcolor{comment}{//  component\_value will be dir[0], dir[1], or dir[2] for x, y, or z components respectively.}}
\DoxyCodeLine{\Hypertarget{a00254_source_l00124}00124             \textcolor{comment}{//}}
\DoxyCodeLine{\Hypertarget{a00254_source_l00125}00125             \textcolor{comment}{//auto angle\_x\_axis = to\_degrees(std::acos(dir[0] / magnitude));}}
\DoxyCodeLine{\Hypertarget{a00254_source_l00126}00126             \textcolor{comment}{//auto angle\_y\_axis = to\_degrees(std::acos(dir[1] / magnitude));}}
\DoxyCodeLine{\Hypertarget{a00254_source_l00127}00127             \textcolor{comment}{//auto angle\_z\_axis = to\_degrees(std::acos(dir[2] / magnitude));}}
\DoxyCodeLine{\Hypertarget{a00254_source_l00128}00128 }
\DoxyCodeLine{\Hypertarget{a00254_source_l00129}00129             \textcolor{comment}{//auto angle = angle\_y\_axis;}}
\DoxyCodeLine{\Hypertarget{a00254_source_l00130}00130             \textcolor{comment}{//auto slope = std::clamp(std::tanf(angle), -\/0.4f, -\/0.4f);}}
\DoxyCodeLine{\Hypertarget{a00254_source_l00131}00131 }
\DoxyCodeLine{\Hypertarget{a00254_source_l00132}00132             \textcolor{keyword}{const} \textcolor{keywordtype}{double} slope = \mbox{\hyperlink{a00475_ae06eb693d0d7858d7a863fae3a6eee2c}{CalculateSlope}}(parent\_node, link\_a.child);}
\DoxyCodeLine{\Hypertarget{a00254_source_l00133}00133             }
\DoxyCodeLine{\Hypertarget{a00254_source_l00134}00134             \textcolor{keyword}{const} \textcolor{keywordtype}{double} g = std::clamp(std::tan(\mbox{\hyperlink{a00475_ae7b446fefe0b9994859f47b85de79039}{to\_radians}}(slope)), -\/0.4, 0.4);}
\DoxyCodeLine{\Hypertarget{a00254_source_l00135}00135 }
\DoxyCodeLine{\Hypertarget{a00254_source_l00136}00136             \textcolor{keyword}{auto} e = 280.5}
\DoxyCodeLine{\Hypertarget{a00254_source_l00137}00137                 * (std::pow(g, 5)) -\/ 58.7}
\DoxyCodeLine{\Hypertarget{a00254_source_l00138}00138                 * (std::pow(g, 4)) -\/ 76.8}
\DoxyCodeLine{\Hypertarget{a00254_source_l00139}00139                 * (std::pow(g, 3)) + 51.9}
\DoxyCodeLine{\Hypertarget{a00254_source_l00140}00140                 * (std::pow(g, 2)) + 19.6}
\DoxyCodeLine{\Hypertarget{a00254_source_l00141}00141                 * (g) + 2.5;}
\DoxyCodeLine{\Hypertarget{a00254_source_l00142}00142 }
\DoxyCodeLine{\Hypertarget{a00254_source_l00143}00143             \textcolor{comment}{// You cannot gain energy. This indicates a programmer error. }}
\DoxyCodeLine{\Hypertarget{a00254_source_l00144}00144             assert(e >= 0);}
\DoxyCodeLine{\Hypertarget{a00254_source_l00145}00145 }
\DoxyCodeLine{\Hypertarget{a00254_source_l00146}00146             \textcolor{comment}{// Calculate the new score/distance for the IntEdge}}
\DoxyCodeLine{\Hypertarget{a00254_source_l00147}00147             \textcolor{keywordtype}{double} expenditure = e * magnitude;}
\DoxyCodeLine{\Hypertarget{a00254_source_l00148}00148 }
\DoxyCodeLine{\Hypertarget{a00254_source_l00149}00149             \textcolor{comment}{// Create the resulting IntEdge from the current child ID and calculation}}
\DoxyCodeLine{\Hypertarget{a00254_source_l00150}00150             \mbox{\hyperlink{a01531}{IntEdge}} ie = \{ link\_a.\mbox{\hyperlink{a01531_a7662d9deb8c69743b37c0c8da3f51610}{child}}.id, \textcolor{keyword}{static\_cast<}\textcolor{keywordtype}{float}\textcolor{keyword}{>}(expenditure) \}; }
\DoxyCodeLine{\Hypertarget{a00254_source_l00151}00151 }
\DoxyCodeLine{\Hypertarget{a00254_source_l00152}00152             \textcolor{comment}{// Dereference the vector<IntEdge> iterator, assign it to the IntEdge created,}}
\DoxyCodeLine{\Hypertarget{a00254_source_l00153}00153             \textcolor{comment}{// then advance the iterator.}}
\DoxyCodeLine{\Hypertarget{a00254_source_l00154}00154             *(it\_children++) = ie;}
\DoxyCodeLine{\Hypertarget{a00254_source_l00155}00155         \}}
\DoxyCodeLine{\Hypertarget{a00254_source_l00156}00156         }
\DoxyCodeLine{\Hypertarget{a00254_source_l00157}00157         \mbox{\hyperlink{a01535}{EdgeSet}} es = \{ parent\_node.\mbox{\hyperlink{a02071_a8212d00e6913abf0ca6fec1f2624b677}{id}}, children \};}
\DoxyCodeLine{\Hypertarget{a00254_source_l00158}00158 }
\DoxyCodeLine{\Hypertarget{a00254_source_l00159}00159         \textcolor{keywordflow}{return} es;}
\DoxyCodeLine{\Hypertarget{a00254_source_l00160}00160     \}}
\DoxyCodeLine{\Hypertarget{a00254_source_l00161}00161 }
\DoxyCodeLine{\Hypertarget{a00254_source_l00162}\mbox{\hyperlink{a00475_adbe5e58355a884494d6e99bf17fc5f7b}{00162}}     std::vector<EdgeSet> \mbox{\hyperlink{a00475_ac51f2e76c00356f8a6145bee865cd922}{CalculateEnergyExpenditure}}(\textcolor{keyword}{const} \mbox{\hyperlink{a01551}{Graph}}\& g) \{}
\DoxyCodeLine{\Hypertarget{a00254_source_l00163}00163         \textcolor{comment}{// Retrieve all nodes from g so we can obtain subgraphs.}}
\DoxyCodeLine{\Hypertarget{a00254_source_l00164}00164         std::vector<Node> nodes = g.\mbox{\hyperlink{a01551_aa70347b8a33b57c6f0a72d6eca4248d7}{Nodes}}();}
\DoxyCodeLine{\Hypertarget{a00254_source_l00165}00165 }
\DoxyCodeLine{\Hypertarget{a00254_source_l00166}00166         \textcolor{comment}{// The result container will always be, at most, the node count of g.}}
\DoxyCodeLine{\Hypertarget{a00254_source_l00167}00167         \textcolor{comment}{// We can preallocate this memory so we do not have to resize during the loop below.}}
\DoxyCodeLine{\Hypertarget{a00254_source_l00168}00168         std::vector<EdgeSet> result(nodes.size());}
\DoxyCodeLine{\Hypertarget{a00254_source_l00169}00169         \textcolor{keyword}{auto} it\_result = result.begin();}
\DoxyCodeLine{\Hypertarget{a00254_source_l00170}00170 }
\DoxyCodeLine{\Hypertarget{a00254_source_l00171}00171         \textcolor{keywordflow}{for} (\mbox{\hyperlink{a02071}{Node}} parent\_node : nodes) \{}
\DoxyCodeLine{\Hypertarget{a00254_source_l00172}00172             \textcolor{comment}{// For all Node in g...}}
\DoxyCodeLine{\Hypertarget{a00254_source_l00173}00173 }
\DoxyCodeLine{\Hypertarget{a00254_source_l00174}00174             \textcolor{comment}{// Get the Subgraph via parent\_node}}
\DoxyCodeLine{\Hypertarget{a00254_source_l00175}00175             \mbox{\hyperlink{a00465_a01543}{Subgraph}} sg = g.\mbox{\hyperlink{a01551_a89250c619a726fd0adbd71778d166887}{GetSubgraph}}(parent\_node);}
\DoxyCodeLine{\Hypertarget{a00254_source_l00176}00176 }
\DoxyCodeLine{\Hypertarget{a00254_source_l00177}00177             \textcolor{comment}{// Call CalculateEnergyExpenditure using the returned Subgraph,}}
\DoxyCodeLine{\Hypertarget{a00254_source_l00178}00178             \textcolor{comment}{// get a vector<EdgeSet> back}}
\DoxyCodeLine{\Hypertarget{a00254_source_l00179}00179             \mbox{\hyperlink{a01535}{EdgeSet}} energy\_expenditures = \mbox{\hyperlink{a00475_ac51f2e76c00356f8a6145bee865cd922}{CalculateEnergyExpenditure}}(sg);}
\DoxyCodeLine{\Hypertarget{a00254_source_l00180}00180 }
\DoxyCodeLine{\Hypertarget{a00254_source_l00181}00181             \textcolor{comment}{// Dereference it\_result, assign it to the energy\_expenditures container,}}
\DoxyCodeLine{\Hypertarget{a00254_source_l00182}00182             \textcolor{comment}{// then advance it\_result (std::vector<std::vector<EdgeSet>>::iterator)}}
\DoxyCodeLine{\Hypertarget{a00254_source_l00183}00183             *(it\_result++) = energy\_expenditures;}
\DoxyCodeLine{\Hypertarget{a00254_source_l00184}00184         \}}
\DoxyCodeLine{\Hypertarget{a00254_source_l00185}00185 }
\DoxyCodeLine{\Hypertarget{a00254_source_l00186}00186         \textcolor{keywordflow}{return} result;}
\DoxyCodeLine{\Hypertarget{a00254_source_l00187}00187     \}}
\DoxyCodeLine{\Hypertarget{a00254_source_l00188}00188 }
\DoxyCodeLine{\Hypertarget{a00254_source_l00189}\mbox{\hyperlink{a00475_a51b88e596c3b5f68b7abbcbc91e30bdf}{00189}}     std::vector<IntEdge> \mbox{\hyperlink{a00475_a51b88e596c3b5f68b7abbcbc91e30bdf}{CalculateCrossSlope}}(\textcolor{keyword}{const} \mbox{\hyperlink{a00465_a01543}{Subgraph}}\& sg) \{}
\DoxyCodeLine{\Hypertarget{a00254_source_l00190}00190         \textcolor{comment}{// All cross slope data for Subgraph sg will be stored here }}
\DoxyCodeLine{\Hypertarget{a00254_source_l00191}00191         \textcolor{comment}{// and returned from this function.}}
\DoxyCodeLine{\Hypertarget{a00254_source_l00192}00192         std::vector<IntEdge> result;}
\DoxyCodeLine{\Hypertarget{a00254_source_l00193}00193 }
\DoxyCodeLine{\Hypertarget{a00254_source_l00194}00194         \mbox{\hyperlink{a02071}{Node}} parent\_node = sg.\mbox{\hyperlink{a00465_a2f8de99f10387d075d7d69336e4d5dd7}{m\_parent}};}
\DoxyCodeLine{\Hypertarget{a00254_source_l00195}00195         std::vector<Edge> edges = sg.\mbox{\hyperlink{a00465_ac1403ade5ddeb5410a523871f96e1e64}{m\_edges}};}
\DoxyCodeLine{\Hypertarget{a00254_source_l00196}00196 }
\DoxyCodeLine{\Hypertarget{a00254_source_l00197}00197         \textcolor{keywordflow}{for} (\mbox{\hyperlink{a01527}{Edge}} edge\_a : edges) \{}
\DoxyCodeLine{\Hypertarget{a00254_source_l00198}00198             \textcolor{comment}{// We iterate over all edges that extend from parent\_node. }}
\DoxyCodeLine{\Hypertarget{a00254_source_l00199}00199             \mbox{\hyperlink{a02071}{Node}} child\_node\_a = edge\_a.child;}
\DoxyCodeLine{\Hypertarget{a00254_source_l00200}00200             \textcolor{keywordtype}{float} edge\_data\_a = edge\_a.score;}
\DoxyCodeLine{\Hypertarget{a00254_source_l00201}00201 }
\DoxyCodeLine{\Hypertarget{a00254_source_l00202}00202             \textcolor{comment}{//}}
\DoxyCodeLine{\Hypertarget{a00254_source_l00203}00203             \textcolor{comment}{//  Here -\/-\/ we should assess the step\_type field for edge\_a.}}
\DoxyCodeLine{\Hypertarget{a00254_source_l00204}00204             \textcolor{comment}{//}}
\DoxyCodeLine{\Hypertarget{a00254_source_l00205}00205             \textcolor{comment}{//  /// <summary> Describes the type of step an edge connects to. </summary>}}
\DoxyCodeLine{\Hypertarget{a00254_source_l00206}00206             \textcolor{comment}{//  enum STEP \{}}
\DoxyCodeLine{\Hypertarget{a00254_source_l00207}00207             \textcolor{comment}{//      NOT\_CONNECTED = 0, ///< No connection between parent and child.}}
\DoxyCodeLine{\Hypertarget{a00254_source_l00208}00208             \textcolor{comment}{//      NONE = 1,        ///< Parent and child are on the same plane and no step is required.}}
\DoxyCodeLine{\Hypertarget{a00254_source_l00209}00209             \textcolor{comment}{//      UP = 2,         ///< A step up is required to get from parent to child.}}
\DoxyCodeLine{\Hypertarget{a00254_source_l00210}00210             \textcolor{comment}{//      DOWN = 3,       ///< A step down is required to get from parent to child.}}
\DoxyCodeLine{\Hypertarget{a00254_source_l00211}00211             \textcolor{comment}{//      OVER = 4        ///< A step over something is required to get from parent to child.}}
\DoxyCodeLine{\Hypertarget{a00254_source_l00212}00212             \textcolor{comment}{//  \};}}
\DoxyCodeLine{\Hypertarget{a00254_source_l00213}00213             \textcolor{comment}{//}}
\DoxyCodeLine{\Hypertarget{a00254_source_l00214}00214 }
\DoxyCodeLine{\Hypertarget{a00254_source_l00215}00215             \textcolor{comment}{// We must have a container to store all perpendicular edges found.}}
\DoxyCodeLine{\Hypertarget{a00254_source_l00216}00216             \textcolor{comment}{// This container will have all edges that are perpendicular to edge\_a -\/-\/}}
\DoxyCodeLine{\Hypertarget{a00254_source_l00217}00217             \textcolor{comment}{// or rather, the vector formed by parent\_node and child\_node\_a.}}
\DoxyCodeLine{\Hypertarget{a00254_source_l00218}00218 }
\DoxyCodeLine{\Hypertarget{a00254_source_l00219}00219             \textcolor{comment}{// Note that we are checking for perpendicularity in 2D space only.}}
\DoxyCodeLine{\Hypertarget{a00254_source_l00220}00220             std::vector<Edge> perpendicular\_edges = GetPerpendicularEdges<2>(sg, child\_node\_a);}
\DoxyCodeLine{\Hypertarget{a00254_source_l00221}00221 }
\DoxyCodeLine{\Hypertarget{a00254_source_l00222}00222             \textcolor{keywordtype}{float} weight = 0.0;}
\DoxyCodeLine{\Hypertarget{a00254_source_l00223}00223             \textcolor{keywordtype}{float} cross\_slope = 0.0;}
\DoxyCodeLine{\Hypertarget{a00254_source_l00224}00224             \textcolor{keywordtype}{float} a\_z = 0.0;}
\DoxyCodeLine{\Hypertarget{a00254_source_l00225}00225             \textcolor{keywordtype}{float} b\_z = 0.0;}
\DoxyCodeLine{\Hypertarget{a00254_source_l00226}00226             \textcolor{keywordtype}{float} c\_z = 0.0;}
\DoxyCodeLine{\Hypertarget{a00254_source_l00227}00227 }
\DoxyCodeLine{\Hypertarget{a00254_source_l00228}00228             \textcolor{keywordflow}{switch} (perpendicular\_edges.size()) \{}
\DoxyCodeLine{\Hypertarget{a00254_source_l00229}00229             \textcolor{keywordflow}{case} 0:}
\DoxyCodeLine{\Hypertarget{a00254_source_l00230}00230                 \textcolor{comment}{// No edges were found to be perpendicular to the edge}}
\DoxyCodeLine{\Hypertarget{a00254_source_l00231}00231                 \textcolor{comment}{// formed by node parent\_node and node child\_node\_a.}}
\DoxyCodeLine{\Hypertarget{a00254_source_l00232}00232                 \textcolor{comment}{// The IntEdge to be created will use the existing edge data}}
\DoxyCodeLine{\Hypertarget{a00254_source_l00233}00233                 \textcolor{comment}{// of parent\_node and child\_node\_a (edge\_data\_a).}}
\DoxyCodeLine{\Hypertarget{a00254_source_l00234}00234                 weight = edge\_data\_a;}
\DoxyCodeLine{\Hypertarget{a00254_source_l00235}00235                 \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{a00254_source_l00236}00236             \textcolor{keywordflow}{case} 1:}
\DoxyCodeLine{\Hypertarget{a00254_source_l00237}00237                 \textcolor{comment}{// One edge formed by node parent\_node and another child\_node}}
\DoxyCodeLine{\Hypertarget{a00254_source_l00238}00238                 \textcolor{comment}{// was found to be perpendicular to the edge formed by}}
\DoxyCodeLine{\Hypertarget{a00254_source_l00239}00239                 \textcolor{comment}{// node parent\_node and node child\_node\_a.}}
\DoxyCodeLine{\Hypertarget{a00254_source_l00240}00240 }
\DoxyCodeLine{\Hypertarget{a00254_source_l00241}00241                 a\_z = child\_node\_a.\mbox{\hyperlink{a02071_a495b47689917e0395ce96ee01d3f5ed3}{z}};}
\DoxyCodeLine{\Hypertarget{a00254_source_l00242}00242 }
\DoxyCodeLine{\Hypertarget{a00254_source_l00243}00243                 \textcolor{comment}{// z value of other child\_node}}
\DoxyCodeLine{\Hypertarget{a00254_source_l00244}00244                 b\_z = perpendicular\_edges[0].child.z;}
\DoxyCodeLine{\Hypertarget{a00254_source_l00245}00245 }
\DoxyCodeLine{\Hypertarget{a00254_source_l00246}00246                 cross\_slope = std::abs(a\_z -\/ b\_z);}
\DoxyCodeLine{\Hypertarget{a00254_source_l00247}00247 }
\DoxyCodeLine{\Hypertarget{a00254_source_l00248}00248                 \textcolor{comment}{// add the existing weight value}}
\DoxyCodeLine{\Hypertarget{a00254_source_l00249}00249                 weight = cross\_slope + perpendicular\_edges[0].score;}
\DoxyCodeLine{\Hypertarget{a00254_source_l00250}00250                 \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{a00254_source_l00251}00251             \textcolor{keywordflow}{case} 2:}
\DoxyCodeLine{\Hypertarget{a00254_source_l00252}00252                 \textcolor{comment}{// Two edges -\/-\/ each formed by node parent\_node and two separate child node}}
\DoxyCodeLine{\Hypertarget{a00254_source_l00253}00253                 \textcolor{comment}{// were found to be perpendicular to the edge formed by}}
\DoxyCodeLine{\Hypertarget{a00254_source_l00254}00254                 \textcolor{comment}{// node parent\_node and node child\_node\_a.}}
\DoxyCodeLine{\Hypertarget{a00254_source_l00255}00255 }
\DoxyCodeLine{\Hypertarget{a00254_source_l00256}00256                 a\_z = child\_node\_a.\mbox{\hyperlink{a02071_a495b47689917e0395ce96ee01d3f5ed3}{z}};}
\DoxyCodeLine{\Hypertarget{a00254_source_l00257}00257 }
\DoxyCodeLine{\Hypertarget{a00254_source_l00258}00258                 \textcolor{comment}{// z value of the first other child\_node}}
\DoxyCodeLine{\Hypertarget{a00254_source_l00259}00259                 b\_z = perpendicular\_edges[0].child.z;}
\DoxyCodeLine{\Hypertarget{a00254_source_l00260}00260 }
\DoxyCodeLine{\Hypertarget{a00254_source_l00261}00261                 \textcolor{comment}{// z value of the second other child node}}
\DoxyCodeLine{\Hypertarget{a00254_source_l00262}00262                 c\_z = perpendicular\_edges[1].child.z;}
\DoxyCodeLine{\Hypertarget{a00254_source_l00263}00263 }
\DoxyCodeLine{\Hypertarget{a00254_source_l00264}00264                 cross\_slope = std::abs(b\_z -\/ c\_z);}
\DoxyCodeLine{\Hypertarget{a00254_source_l00265}00265 }
\DoxyCodeLine{\Hypertarget{a00254_source_l00266}00266                 \textcolor{comment}{// add the existing weight value}}
\DoxyCodeLine{\Hypertarget{a00254_source_l00267}00267                 weight = std::abs(b\_z -\/ c\_z) + perpendicular\_edges[0].score;}
\DoxyCodeLine{\Hypertarget{a00254_source_l00268}00268                 \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{a00254_source_l00269}00269             \textcolor{keywordflow}{default}:}
\DoxyCodeLine{\Hypertarget{a00254_source_l00270}00270                 \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{a00254_source_l00271}00271             \}}
\DoxyCodeLine{\Hypertarget{a00254_source_l00272}00272 }
\DoxyCodeLine{\Hypertarget{a00254_source_l00273}00273             \textcolor{comment}{// Create the IntEdge using child\_node\_a.id}}
\DoxyCodeLine{\Hypertarget{a00254_source_l00274}00274             \textcolor{comment}{// and the (cross slope value + existing edge score)}}
\DoxyCodeLine{\Hypertarget{a00254_source_l00275}00275             \textcolor{comment}{// -\/-\/ then add it to our result container.}}
\DoxyCodeLine{\Hypertarget{a00254_source_l00276}00276             \mbox{\hyperlink{a01531}{IntEdge}} ie = \{ child\_node\_a.\mbox{\hyperlink{a02071_a8212d00e6913abf0ca6fec1f2624b677}{id}}, weight \};}
\DoxyCodeLine{\Hypertarget{a00254_source_l00277}00277             result.push\_back(ie);}
\DoxyCodeLine{\Hypertarget{a00254_source_l00278}00278         \}}
\DoxyCodeLine{\Hypertarget{a00254_source_l00279}00279     }
\DoxyCodeLine{\Hypertarget{a00254_source_l00280}00280         \textcolor{keywordflow}{return} result;}
\DoxyCodeLine{\Hypertarget{a00254_source_l00281}00281     \}}
\DoxyCodeLine{\Hypertarget{a00254_source_l00282}00282 }
\DoxyCodeLine{\Hypertarget{a00254_source_l00283}\mbox{\hyperlink{a00475_a6d12a3af69887cb335b490304138afc6}{00283}}     std::vector<std::vector<IntEdge>> \mbox{\hyperlink{a00475_a51b88e596c3b5f68b7abbcbc91e30bdf}{CalculateCrossSlope}}(\textcolor{keyword}{const} \mbox{\hyperlink{a01551}{Graph}}\& g) \{}
\DoxyCodeLine{\Hypertarget{a00254_source_l00284}00284         \textcolor{comment}{// Retrieve all nodes from g so we can obtain subgraphs.}}
\DoxyCodeLine{\Hypertarget{a00254_source_l00285}00285         std::vector<Node> nodes = g.\mbox{\hyperlink{a01551_aa70347b8a33b57c6f0a72d6eca4248d7}{Nodes}}();}
\DoxyCodeLine{\Hypertarget{a00254_source_l00286}00286 }
\DoxyCodeLine{\Hypertarget{a00254_source_l00287}00287         \textcolor{comment}{// The result container will always be, at most, the node count of g.}}
\DoxyCodeLine{\Hypertarget{a00254_source_l00288}00288         \textcolor{comment}{// We can preallocate this memory so we do not have to resize during the loop below.}}
\DoxyCodeLine{\Hypertarget{a00254_source_l00289}00289         std::vector<std::vector<IntEdge>> result(nodes.size());}
\DoxyCodeLine{\Hypertarget{a00254_source_l00290}00290         \textcolor{keyword}{auto} it\_result = result.begin();}
\DoxyCodeLine{\Hypertarget{a00254_source_l00291}00291 }
\DoxyCodeLine{\Hypertarget{a00254_source_l00292}00292         \textcolor{keywordflow}{for} (\mbox{\hyperlink{a02071}{Node}} parent\_node : nodes) \{}
\DoxyCodeLine{\Hypertarget{a00254_source_l00293}00293             \textcolor{comment}{// For all Node in g...}}
\DoxyCodeLine{\Hypertarget{a00254_source_l00294}00294 }
\DoxyCodeLine{\Hypertarget{a00254_source_l00295}00295             \textcolor{comment}{// Get the Subgraph via parent\_node}}
\DoxyCodeLine{\Hypertarget{a00254_source_l00296}00296             \mbox{\hyperlink{a00465_a01543}{Subgraph}} sg = g.\mbox{\hyperlink{a01551_a89250c619a726fd0adbd71778d166887}{GetSubgraph}}(parent\_node);}
\DoxyCodeLine{\Hypertarget{a00254_source_l00297}00297 }
\DoxyCodeLine{\Hypertarget{a00254_source_l00298}00298             \textcolor{comment}{// Call CalculateCrossSlope using the returned Subgraph,}}
\DoxyCodeLine{\Hypertarget{a00254_source_l00299}00299             \textcolor{comment}{// get a vector<IntEdge> back}}
\DoxyCodeLine{\Hypertarget{a00254_source_l00300}00300             std::vector<IntEdge> cross\_slopes = \mbox{\hyperlink{a00475_a51b88e596c3b5f68b7abbcbc91e30bdf}{CalculateCrossSlope}}(sg);}
\DoxyCodeLine{\Hypertarget{a00254_source_l00301}00301 }
\DoxyCodeLine{\Hypertarget{a00254_source_l00302}00302             \textcolor{comment}{// Dereference it\_result, assign it to the cross\_slopes container,}}
\DoxyCodeLine{\Hypertarget{a00254_source_l00303}00303             \textcolor{comment}{// then advance it\_result (std::vector<std::vector<IntEdge>>::iterator)}}
\DoxyCodeLine{\Hypertarget{a00254_source_l00304}00304             *(it\_result++) = cross\_slopes;}
\DoxyCodeLine{\Hypertarget{a00254_source_l00305}00305         \}}
\DoxyCodeLine{\Hypertarget{a00254_source_l00306}00306 }
\DoxyCodeLine{\Hypertarget{a00254_source_l00307}00307         \textcolor{keywordflow}{return} result;}
\DoxyCodeLine{\Hypertarget{a00254_source_l00308}00308     \}}
\DoxyCodeLine{\Hypertarget{a00254_source_l00309}00309 \}}

\end{DoxyCode}
